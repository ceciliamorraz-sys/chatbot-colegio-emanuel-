<script>
/* =========================
   ðŸ”Š CONFIGURACIÃ“N DE VOZ
========================= */
let vozActiva = true;

function hablar(texto) {
  if (!vozActiva) return;
  const mensaje = new SpeechSynthesisUtterance(texto);
  mensaje.lang = "es-ES";
  mensaje.rate = 1;
  mensaje.pitch = 1;
  speechSynthesis.cancel();
  speechSynthesis.speak(mensaje);
}

/* =========================
   ðŸ’¬ MENSAJES
========================= */
function addBotMessage(texto) {
  const cont = document.getElementById("chat-messages");
  const div = document.createElement("div");
  div.className = "msg";
  div.innerText = texto;
  cont.appendChild(div);
  cont.scrollTop = cont.scrollHeight;
  hablar(texto);
}

function addUserMessage(texto) {
  const cont = document.getElementById("chat-messages");
  const div = document.createElement("div");
  div.className = "msg user";
  div.innerText = texto;
  cont.appendChild(div);
  cont.scrollTop = cont.scrollHeight;
}

/* =========================
   ðŸ§  NORMALIZAR TEXTO
========================= */
function normalizeText(text) {
  return text
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .trim();
}

/* =========================
   ðŸ‘‹ SALUDO INICIAL (UNA SOLA VEZ)
========================= */
let saludoDado = false;

function saludoInicial() {
  if (saludoDado) return;
  saludoDado = true;

  addBotMessage("ðŸ‘‹ Bienvenido al Colegio Integral Emanuel.");
  addBotMessage("Soy EmaBot, el asistente virtual institucional.");
  addBotMessage("â° Horario de atenciÃ³n: Lunes a Viernes, de 7:00 a.m. a 3:00 p.m.");
  addBotMessage(
    "ðŸ“– El texto bÃ­blico de hoy es: â€œInstruye al niÃ±o en su camino, y aun cuando fuere viejo no se apartarÃ¡ de Ã©l.â€ Proverbios 22:6"
  );
  addBotMessage("ðŸ˜Š Â¿En quÃ© mÃ¡s podemos ayudarte?");
}

/* =========================
   ðŸ“¨ MANEJO DE PREGUNTAS
========================= */
function handleUserQuestion() {
  const input = document.getElementById("user-input");
  if (!input || !input.value) return;

  const pregunta = input.value;
  addUserMessage(pregunta);
  input.value = "";

  const q = normalizeText(pregunta);

  if (q.includes("direccion") || q.includes("ubicacion")) {
    addBotMessage("ðŸ“ Costado Este del MaxiPali, 25 varas al norte.");
    cerrarConBendicion();
    return;
  }

  if (q.includes("mensualidad") || q.includes("cuota")) {
    addBotMessage("ðŸ’µ La mensualidad es de C$ 1,450.");
    cerrarConBendicion();
    return;
  }

  if (q.includes("matricula") || q.includes("inscripcion")) {
    addBotMessage("ðŸ“² La informaciÃ³n de matrÃ­cula se brinda directamente por WhatsApp.");
    window.open("https://wa.me/50588543012", "_blank");
    cerrarConBendicion();
    return;
  }

  if (q.includes("ofrece") || q.includes("servicios")) {
    addBotMessage(
      "ðŸŽ“ Ofrecemos educaciÃ³n integral, formaciÃ³n en valores cristianos, docentes capacitados y un ambiente seguro."
    );
    cerrarConBendicion();
    return;
  }

  // â“ NO SABE â†’ WHATSAPP DIRECTO
  addBotMessage("ðŸ“² No tengo esa informaciÃ³n registrada. Te atendemos directamente por WhatsApp.");
  window.open("https://wa.me/50588543012", "_blank");
  cerrarConBendicion();
}

/* =========================
   âœï¸ DESPEDIDA
========================= */
function cerrarConBendicion() {
  setTimeout(() => {
    addBotMessage("ðŸ™ Bendiciones, quedamos a su disposiciÃ³n.");
  }, 800);
}

/* =========================
   ðŸš€ INICIAR
========================= */
document.addEventListener("DOMContentLoaded", () => {
  setTimeout(saludoInicial, 800);
});
</script>
