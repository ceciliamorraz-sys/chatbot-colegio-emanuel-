<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EmaBot - Colegio Integral Emanuel</title>

  <style>
    body { font-family: Arial, sans-serif; }

    /* Bot√≥n flotante */
    #chat-btn{
      position: fixed; bottom: 20px; right: 20px;
      background: #1f6feb; color: #fff; border: none;
      border-radius: 50%; width: 60px; height: 60px;
      font-size: 26px; cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 99999;
    }

    /* Caja del chat */
    #chat-box{
      display:none;
      position: fixed; bottom: 90px; right: 20px;
      width: 360px; max-width: calc(100vw - 40px);
      height: 520px; max-height: calc(100vh - 140px);
      background:#fff; border-radius: 14px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.25);
      overflow:hidden;
      z-index: 99999;
    }

    /* Responsive tel√©fono */
    @media (max-width: 520px){
      #chat-box{
        right: 10px; left: 10px;
        width: auto;
        bottom: 80px;
        height: 70vh; max-height: 70vh;
      }
      #chat-btn{ right: 14px; bottom: 14px; }
    }

    /* Header */
    #chat-header{
      background:#1f6feb; color:#fff;
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between;
      font-weight:bold;
      gap:10px;
    }
    #chat-header .title{
      display:flex; align-items:center; gap:8px;
      min-width: 0;
    }
    #chat-header .title span{
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      display:block; max-width: 220px;
    }
    #chat-header .actions{ display:flex; gap:10px; align-items:center; }
    #chat-header button{
      background:transparent; border:none; color:#fff;
      font-size:18px; cursor:pointer;
    }

    /* Mensajes */
    #chat-messages{
      padding: 12px;
      height: 330px;
      overflow-y: auto;
      background:#f4f6f8;
    }
    .msg{
      background:#fff;
      border-radius: 12px;
      padding: 10px 12px;
      margin-bottom: 10px;
      line-height: 1.35;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }
    .msg.bot{ border-left: 4px solid #1f6feb; }
    .msg.user{
      background:#e8f1ff;
      border-left: 4px solid #0b5bd3;
    }

    /* Bloque opciones */
    #options{
      padding: 10px 12px;
      border-top: 1px solid #e6e6e6;
      background:#fff;
    }
    #options .label{
      font-weight: bold;
      background:#fff3e6;
      border:1px solid #ffd2a6;
      padding:10px 12px;
      border-radius: 12px;
      margin-bottom:10px;
    }
    .opt{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border:1px solid #e6e6e6;
      border-radius: 12px;
      margin-bottom:8px;
      cursor:pointer;
      user-select:none;
    }
    .opt:hover{ background:#f7fbff; }

    /* Input */
    #chat-input{
      display:flex;
      gap:10px;
      padding: 10px 12px;
      border-top: 1px solid #e6e6e6;
      background:#fff;
    }
    #chat-input input{
      flex:1;
      padding:10px 12px;
      border-radius: 10px;
      border:1px solid #d9d9d9;
      outline:none;
    }
    #chat-input button{
      background:#1f6feb; color:#fff; border:none;
      padding: 10px 14px;
      border-radius: 10px;
      cursor:pointer;
      font-weight:bold;
    }

    /* Bot√≥n grande para iniciar voz */
    #start-voice{
      width:100%;
      padding:12px;
      margin:10px 0;
      border:none;
      border-radius:12px;
      background:#1f6feb;
      color:white;
      font-weight:bold;
      cursor:pointer;
    }

    /* Formulario (modal simple) */
    #contact-modal{
      display:none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.35);
      z-index: 999999;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    #contact-modal .card{
      width: 520px; max-width: 100%;
      background:#fff;
      border-radius: 14px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
      overflow: hidden;
    }
    #contact-modal .card header{
      background:#1f6feb; color:#fff;
      padding: 12px 14px;
      display:flex; justify-content:space-between; align-items:center;
      font-weight:bold;
    }
    #contact-modal .card header button{
      background:transparent; border:none; color:#fff;
      font-size:18px; cursor:pointer;
    }
    #contact-modal .card .body{ padding: 14px; }
    #contact-modal label{ display:block; font-weight:bold; margin-top:10px; }
    #contact-modal input, #contact-modal textarea{
      width:100%;
      margin-top:6px;
      padding:10px 12px;
      border:1px solid #d9d9d9;
      border-radius: 10px;
      outline:none;
      font-family: Arial, sans-serif;
    }
    #contact-modal textarea{ min-height: 110px; resize: vertical; }
    #contact-modal .actions{
      display:flex; gap:10px; justify-content:flex-end;
      margin-top: 12px;
    }
    #contact-modal .actions button{
      border:none; border-radius:10px; padding:10px 14px;
      cursor:pointer; font-weight:bold;
    }
    #btn-cancel{ background:#e9e9e9; }
    #btn-send{ background:#1f6feb; color:#fff; }
    .small{ font-size: 12px; color:#666; margin-top:8px; }
  </style>
</head>

<body>

  <!-- Bot√≥n flotante -->
  <button id="chat-btn" aria-label="Abrir chat">üí¨</button>

  <!-- Chat -->
  <div id="chat-box">
    <div id="chat-header">
      <div class="title">
        <span>ü§ñ EmaBot ‚Äì Colegio Integral Emanuel</span>
      </div>
      <div class="actions">
        <button id="voice-toggle" title="Activar/Desactivar voz">üîá</button>
        <button id="close-chat" title="Cerrar">‚úï</button>
      </div>
    </div>

    <div id="chat-messages"></div>

    <div id="options">
      <div class="label">Seleccione una opci√≥n:</div>

      <!-- Bot√≥n para habilitar voz (requerido en tel√©fono) -->
      <button id="start-voice">üîä Iniciar voz (como Alexa)</button>

      <div class="opt" data-key="direccion">üìç Direcci√≥n</div>
      <div class="opt" data-key="matricula">üíµ Matr√≠cula</div>
      <div class="opt" data-key="mensualidad">üßæ Mensualidad</div>
      <div class="opt" data-key="horario">‚è∞ Horario</div>
      <div class="opt" data-key="ofrece">üéì ¬øQu√© ofrece?</div>
      <div class="opt" data-key="contacto">üìù Formulario de contacto</div>
      <div class="opt" data-key="whatsapp">üì≤ WhatsApp</div>
    </div>

    <div id="chat-input">
      <input id="user-input" type="text" placeholder="Escribe tu pregunta aqu√≠..." />
      <button id="send-btn">Enviar</button>
    </div>
  </div>

  <!-- Modal Formulario -->
  <div id="contact-modal">
    <div class="card">
      <header>
        <span>üìù Formulario de contacto</span>
        <button id="close-modal">‚úï</button>
      </header>
      <div class="body">
        <label>Nombre</label>
        <input id="c-name" type="text" placeholder="Tu nombre" />

        <label>Tel√©fono</label>
        <input id="c-phone" type="tel" placeholder="Ej: 8888-8888" />

        <label>Correo</label>
        <input id="c-email" type="email" placeholder="correo@ejemplo.com" />

        <label>Mensaje</label>
        <textarea id="c-msg" placeholder="Escribe tu consulta..."></textarea>

        <div class="small">
          Nota: Este formulario se enviar√° por WhatsApp al n√∫mero institucional.
        </div>

        <div class="actions">
          <button id="btn-cancel">Cancelar</button>
          <button id="btn-send">Enviar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== Elementos ======
    const chatBtn = document.getElementById("chat-btn");
    const chatBox = document.getElementById("chat-box");
    const closeChat = document.getElementById("close-chat");

    const messages = document.getElementById("chat-messages");
    const userInput = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");

    const options = document.querySelectorAll(".opt");

    const voiceBtn = document.getElementById("voice-toggle");
    const startVoiceBtn = document.getElementById("start-voice");

    const modal = document.getElementById("contact-modal");
    const closeModal = document.getElementById("close-modal");
    const btnCancel = document.getElementById("btn-cancel");
    const btnSend = document.getElementById("btn-send");

    // ====== Config ======
    const WHATSAPP_NUMBER = "58753725"; // tu n√∫mero
    let voiceEnabled = false;

    // ====== Utilidades ======
    function addMessage(text, who="bot"){
      const div = document.createElement("div");
      div.className = `msg ${who}`;
      div.textContent = text;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;

      // Hablar si est√° habilitado y es bot
      if(who === "bot" && voiceEnabled){
        speak(text);
      }
    }

    function speak(text){
      try{
        if(!("speechSynthesis" in window)) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = "es-ES";

        // intentar elegir voz espa√±ola si existe
        const voices = window.speechSynthesis.getVoices();
        const prefer = voices.find(v => (v.lang || "").toLowerCase().startsWith("es"));
        if(prefer) u.voice = prefer;

        window.speechSynthesis.speak(u);
      }catch(e){
        // silencioso
      }
    }

    function openWhatsApp(message){
      const url = `https://wa.me/505${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
      window.open(url, "_blank");
    }

    function botAnswer(input){
      const t = (input || "").toLowerCase().trim();

      // Si pregunta cosas fuera, mandamos WhatsApp directo
      const unknownFallback = () => {
        addMessage("No tengo esa informaci√≥n aqu√≠. Con gusto le atendemos por WhatsApp ‚úÖ");
        openWhatsApp("Hola, necesito informaci√≥n del Colegio Integral Emanuel. ¬øMe pueden apoyar?");
      };

      // Respuestas por palabras clave
      if(t.includes("direccion") || t.includes("direcci√≥n") || t.includes("ubicacion") || t.includes("ubicaci√≥n")){
        addMessage("üìç Direcci√≥n: Costado Este del MaxiPali, 25 varas al norte.");
        return;
      }
      if(t.includes("matricula") || t.includes("matr√≠cula")){
        addMessage("üíµ Matr√≠cula: Para informaci√≥n exacta, cont√°ctenos por WhatsApp y con gusto le atendemos.");
        openWhatsApp("Hola, ¬øme brindan el costo de matr√≠cula y requisitos, por favor?");
        return;
      }
      if(t.includes("mensualidad")){
        addMessage("üßæ Mensualidad: Para confirmar costos por grado, escr√≠banos por WhatsApp.");
        openWhatsApp("Hola, ¬øme brindan el costo de mensualidad por grado, por favor?");
        return;
      }
      if(t.includes("horario")){
        addMessage("‚è∞ Horario de atenci√≥n: Lunes a Viernes, 7:00 a.m. a 3:00 p.m.");
        return;
      }
      if(t.includes("ofrece") || t.includes("ofrecen") || t.includes("servicios")){
        addMessage("üéì Ofrecemos educaci√≥n integral, formaci√≥n en valores, docentes capacitados y acompa√±amiento a las familias.");
        addMessage("Si desea m√°s detalles (grados, requisitos, cupos), escriba por WhatsApp y le guiamos.");
        openWhatsApp("Hola, quisiera informaci√≥n sobre qu√© ofrece el colegio (grados, requisitos y cupos).");
        return;
      }
      if(t.includes("whatsapp") || t.includes("contacto") || t.includes("telefono") || t.includes("tel√©fono")){
        addMessage("üì≤ Puede escribirnos directamente por WhatsApp. Le abrir√© el enlace ahora ‚úÖ");
        openWhatsApp("Hola, deseo informaci√≥n del Colegio Integral Emanuel.");
        return;
      }

      // Si no reconoce
      unknownFallback();
    }

    // ====== Inicio del chat ======
    function initWelcome(){
      messages.innerHTML = "";
      addMessage("üëã Bienvenido(a) al Colegio Integral Emanuel.");
      addMessage("Soy EmaBot, su asistente virtual institucional.");
      addMessage("‚è∞ Horario de atenci√≥n: Lunes a Viernes, 7:00 a.m. a 3:00 p.m.");
      addMessage("üòä ¬øEn qu√© m√°s podemos ayudarle?");
    }

    // ====== Mostrar/Ocultar ======
    chatBtn.addEventListener("click", () => {
      const open = chatBox.style.display === "block";
      chatBox.style.display = open ? "none" : "block";
      if(!open){
        initWelcome();
      }
    });

    closeChat.addEventListener("click", () => chatBox.style.display = "none");

    // ====== Enviar texto ======
    function sendText(){
      const text = userInput.value.trim();
      if(!text) return;
      addMessage(text, "user");
      userInput.value = "";
      botAnswer(text);
    }

    sendBtn.addEventListener("click", sendText);
    userInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter") sendText();
    });

    // ====== Opciones clic ======
    options.forEach(opt => {
      opt.addEventListener("click", () => {
        const key = opt.dataset.key;

        if(key === "direccion") botAnswer("direccion");
        else if(key === "matricula") botAnswer("matricula");
        else if(key === "mensualidad") botAnswer("mensualidad");
        else if(key === "horario") botAnswer("horario");
        else if(key === "ofrece") botAnswer("que ofrece");
        else if(key === "whatsapp") botAnswer("whatsapp");
        else if(key === "contacto") {
          modal.style.display = "flex";
        }
      });
    });

    // ====== Voz (toggle) ======
    voiceBtn.addEventListener("click", () => {
      voiceEnabled = !voiceEnabled;
      voiceBtn.textContent = voiceEnabled ? "üîä" : "üîá";
      addMessage(voiceEnabled ? "Voz activada ‚úÖ" : "Voz desactivada ‚úÖ");
    });

    // ====== ‚ÄúAlexa‚Äù web: primer click para permitir audio ======
    startVoiceBtn.addEventListener("click", () => {
      voiceEnabled = true;
      voiceBtn.textContent = "üîä";
      addMessage("Voz activada ‚úÖ (en tel√©fono, la voz requiere este primer toque).");
      speak("Hola, soy EmaBot. Bienvenido al Colegio Integral Emanuel. ¬øEn qu√© m√°s podemos ayudarle?");
      startVoiceBtn.style.display = "none";
    });

    // ====== Modal formulario ======
    function closeForm(){
      modal.style.display = "none";
      document.getElementById("c-name").value = "";
      document.getElementById("c-phone").value = "";
      document.getElementById("c-email").value = "";
      document.getElementById("c-msg").value = "";
    }
    closeModal.addEventListener("click", closeForm);
    btnCancel.addEventListener("click", closeForm);
    modal.addEventListener("click", (e) => {
      if(e.target === modal) closeForm();
    });

    btnSend.addEventListener("click", () => {
      const name = document.getElementById("c-name").value.trim();
      const phone = document.getElementById("c-phone").value.trim();
      const email = document.getElementById("c-email").value.trim();
      const msg = document.getElementById("c-msg").value.trim();

      if(!name || !msg){
        alert("Por favor, complete al menos Nombre y Mensaje.");
        return;
      }

      const text =
`Formulario de contacto - Colegio Integral Emanuel
Nombre: ${name}
Tel√©fono: ${phone || "No proporcionado"}
Correo: ${email || "No proporcionado"}
Mensaje: ${msg}`;

      closeForm();
      addMessage("‚úÖ Gracias. Enviaremos su mensaje por WhatsApp.");
      openWhatsApp(text);
      addMessage("‚ú® Bendiciones. Quedamos a su disposici√≥n.");
    });

    // Pre-cargar voces (algunos navegadores las cargan async)
    window.speechSynthesis.onvoiceschanged = () => {};

  </script>

</body>
</html>
