<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EmaBot - Colegio Integral Emanuel</title>

  <style>
    body { font-family: Arial, sans-serif; }

    /* Bot√≥n flotante */
    #chat-btn{
      position: fixed;
      bottom: 18px;
      right: 18px;
      background:#1f6feb;
      color:#fff;
      border:none;
      border-radius:50%;
      width:60px;
      height:60px;
      font-size:26px;
      cursor:pointer;
      box-shadow:0 6px 16px rgba(0,0,0,.25);
      z-index:999999;
    }

    /* Caja del chat (responsive) */
    #chat-box{
      display:none;
      position: fixed;
      bottom: 90px;
      right: 18px;
      width: 380px;
      max-width: calc(100vw - 36px);
      height: 560px;
      max-height: calc(100vh - 140px);
      background:#fff;
      border-radius:16px;
      box-shadow:0 10px 25px rgba(0,0,0,.22);
      overflow:hidden;
      z-index:999999;
    }

    /* En m√≥vil */
    @media (max-width: 520px){
      #chat-box{
        right: 10px;
        left: 10px;
        width: auto;
        bottom: 90px;
        height: 78vh;
        max-height: 78vh;
      }
      #chat-btn{
        right: 14px;
        bottom: 14px;
      }
    }

    #chat-header{
      background:#1f6feb;
      color:#fff;
      padding:12px 14px;
      font-weight:bold;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    #chat-header .left{
      display:flex;
      align-items:center;
      gap:10px;
      overflow:hidden;
    }
    #chat-header .title{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 240px;
    }
    #chat-header .actions{
      display:flex;
      align-items:center;
      gap:8px;
    }
    #chat-header button{
      background:transparent;
      border:none;
      color:#fff;
      cursor:pointer;
      font-size:18px;
      padding:6px;
      border-radius:8px;
    }
    #chat-header button:hover{ background:rgba(255,255,255,.15); }

    /* √Årea scroll (deja espacio al footer fijo) */
    #chat-messages{
      padding:12px;
      height: calc(100% - 56px - 175px);
      overflow-y:auto;
      background:#f4f6f8;
    }

    .msg{
      background:#fff;
      padding:10px 12px;
      margin-bottom:10px;
      border-radius:12px;
      line-height:1.35;
      font-size:14px;
      box-shadow:0 1px 0 rgba(0,0,0,.04);
      white-space:pre-wrap;
    }
    .user{ background:#dff3ff; text-align:right; }
    .bot{ text-align:left; }

    /* Opciones (parte superior) */
    #chat-options{
      padding:12px;
      background:#fff;
      border-top:1px solid #e6e6e6;
    }

    .box-title{
      background:#fff3e0;
      border:1px solid #ffd7b0;
      padding:10px 12px;
      border-radius:12px;
      font-weight:bold;
      margin-bottom:10px;
    }

    .radio-list{
      border:1px solid #e5e7eb;
      border-radius:12px;
      overflow:hidden;
      background:#fff;
      max-height: 220px;
      overflow-y:auto;
    }

    .radio-item{
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px 12px;
      border-bottom:1px solid #eef2f6;
    }
    .radio-item:last-child{ border-bottom:none; }
    .radio-item label{
      width:100%;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:14px;
    }
    .radio-item .left{
      display:flex;
      align-items:center;
      gap:10px;
    }

    /* Footer fijo SIEMPRE VISIBLE */
    #chat-footer{
      position:absolute;
      left:0; right:0; bottom:0;
      padding:10px 12px;
      background:#fff;
      border-top:1px solid #e6e6e6;
    }

    .hint{
      font-size:12px;
      color:#6b7280;
      margin:0 0 8px 2px;
    }

    .footer-row{
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom:8px;
    }

    #answer-btn, #mic-btn, #send-btn{
      border:none;
      border-radius:12px;
      cursor:pointer;
      font-weight:bold;
      font-size:14px;
      padding:10px 12px;
    }

    #answer-btn{
      background:#111827;
      color:#fff;
      flex:1;
    }
    #answer-btn:disabled{
      opacity:.45;
      cursor:not-allowed;
    }

    #mic-btn{
      background:#f3f4f6;
      color:#111827;
      width:52px;
    }

    .input-row{
      display:flex;
      gap:8px;
      align-items:center;
    }

    #user-input{
      flex:1;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid #d1d5db;
      outline:none;
      font-size:14px;
    }

    #send-btn{
      background:#1f6feb;
      color:#fff;
      width:92px;
    }
    #send-btn:hover, #answer-btn:hover{ filter:brightness(.95); }
  </style>
</head>

<body>

<button id="chat-btn" aria-label="Abrir chat">üí¨</button>

<div id="chat-box" role="dialog" aria-label="EmaBot">
  <div id="chat-header">
    <div class="left">
      <span aria-hidden="true">ü§ñ</span>
      <div class="title">EmaBot ‚Äî Colegio Integral Emanuel</div>
    </div>
    <div class="actions">
      <button id="voice-btn" title="Activar/desactivar voz" aria-label="Voz">üîä</button>
      <button id="close-btn" title="Cerrar" aria-label="Cerrar">‚úñ</button>
    </div>
  </div>

  <div id="chat-messages"></div>

  <div id="chat-options">
    <div class="box-title">Seleccione una opci√≥n:</div>

    <div class="radio-list" id="menu">
      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-direccion" value="direccion">
        <label for="opt-direccion">
          <div class="left"><span>üìç</span><span>Direcci√≥n</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-horario" value="horario">
        <label for="opt-horario">
          <div class="left"><span>üïí</span><span>Horario</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-matricula" value="matricula">
        <label for="opt-matricula">
          <div class="left"><span>üíµ</span><span>Matr√≠cula</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-mensualidad" value="mensualidad">
        <label for="opt-mensualidad">
          <div class="left"><span>üìÖ</span><span>Mensualidad</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-ofrece" value="ofrece">
        <label for="opt-ofrece">
          <div class="left"><span>üéì</span><span>¬øQu√© ofrece?</span></div>
        </label>
      </div>

      <!-- M√ÅS PRODUCTIVO -->
      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-requisitos" value="requisitos">
        <label for="opt-requisitos">
          <div class="left"><span>üìù</span><span>Requisitos de matr√≠cula</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-uniforme" value="uniforme">
        <label for="opt-uniforme">
          <div class="left"><span>üëï</span><span>Uniforme</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-utiles" value="utiles">
        <label for="opt-utiles">
          <div class="left"><span>üìö</span><span>Lista de √∫tiles</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-actividades" value="actividades">
        <label for="opt-actividades">
          <div class="left"><span>üèÖ</span><span>Actividades / Eventos</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-calendario" value="calendario">
        <label for="opt-calendario">
          <div class="left"><span>üóìÔ∏è</span><span>Calendario escolar</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-transportes" value="transporte">
        <label for="opt-transportes">
          <div class="left"><span>üöå</span><span>Transporte</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-becas" value="becas">
        <label for="opt-becas">
          <div class="left"><span>üéØ</span><span>Becas / Descuentos</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-contacto" value="contacto">
        <label for="opt-contacto">
          <div class="left"><span>üì≤</span><span>Contacto (WhatsApp)</span></div>
        </label>
      </div>
    </div>
  </div>

  <!-- Footer fijo: aqu√≠ SIEMPRE se ver√°n los botones -->
  <div id="chat-footer">
    <div class="hint">‚úÖ Seleccione una opci√≥n y presione <b>RESPONDER</b> o use el micr√≥fono / escriba su consulta.</div>

    <div class="footer-row">
      <button id="answer-btn" disabled>RESPONDER</button>
      <button id="mic-btn" title="Hablar (dictado)" aria-label="Hablar">üé§</button>
    </div>

    <div class="input-row">
      <input id="user-input" placeholder="Escriba su pregunta..." />
      <button id="send-btn">Enviar</button>
    </div>
  </div>
</div>

<script>
  // =========================
  // CONFIG (ajusta si quieres)
  // =========================
  const WHATSAPP_NUMBER = "50588543012"; // directo al n√∫mero
  const HORARIO = "Lunes a Viernes, 7:00 a.m. a 3:00 p.m.";
  const SITE_NAME = "Colegio Integral Emanuel";
  const BOT_NAME = "EmaBot";

  // =========================
  // ELEMENTOS
  // =========================
  const chatBtn = document.getElementById("chat-btn");
  const chatBox = document.getElementById("chat-box");
  const closeBtn = document.getElementById("close-btn");
  const messages = document.getElementById("chat-messages");

  const answerBtn = document.getElementById("answer-btn");
  const sendBtn = document.getElementById("send-btn");
  const userInput = document.getElementById("user-input");

  const voiceBtn = document.getElementById("voice-btn");
  const micBtn = document.getElementById("mic-btn");

  // =========================
  // VOZ (hablar respuestas)
  // =========================
  let voiceEnabled = false;

  function canSpeak() {
    return "speechSynthesis" in window && typeof SpeechSynthesisUtterance !== "undefined";
  }

  function speak(text) {
    if (!voiceEnabled) return;
    if (!canSpeak()) return;
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "es-ES";
    u.rate = 1.0;
    u.pitch = 1.0;
    window.speechSynthesis.speak(u);
  }

  voiceBtn.addEventListener("click", () => {
    voiceEnabled = !voiceEnabled;
    voiceBtn.textContent = voiceEnabled ? "üîà" : "üîä";
    addBotMessage(voiceEnabled
      ? "‚úÖ Voz activada. Leer√© mis respuestas en voz alta."
      : "üîá Voz desactivada."
    );
  });

  // =========================
  // MICROFONO (dictado)
  // =========================
  let recognition = null;
  function canDictate(){
    return "webkitSpeechRecognition" in window || "SpeechRecognition" in window;
  }

  function startDictation(){
    if (!canDictate()){
      addBotMessage("En este dispositivo/navegador no est√° disponible el dictado por voz. Puede escribir su pregunta.");
      return;
    }
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SR();
    recognition.lang = "es-NI";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    micBtn.textContent = "‚è∫Ô∏è";
    addBotMessage("üé§ Estoy escuchando... hable ahora.");

    recognition.onresult = (event) => {
      const text = event.results[0][0].transcript;
      micBtn.textContent = "üé§";
      userInput.value = text;
      handleUserQuestion(); // env√≠a autom√°ticamente
    };
    recognition.onerror = () => {
      micBtn.textContent = "üé§";
      addBotMessage("No pude escuchar bien. Intente de nuevo o escriba su pregunta.");
    };
    recognition.onend = () => {
      micBtn.textContent = "üé§";
    };

    recognition.start();
  }

  micBtn.addEventListener("click", startDictation);

  // =========================
  // UTILIDADES CHAT
  // =========================
  function addBotMessage(text) {
    const div = document.createElement("div");
    div.className = "msg bot";
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
    speak(text);
  }

  function addUserMessage(text) {
    const div = document.createElement("div");
    div.className = "msg user";
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function normalizeText(text) {
    return text
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .trim();
  }

  function openWhatsAppDirect() {
    window.open("https://wa.me/" + WHATSAPP_NUMBER, "_blank");
  }

  // =========================
  // RESPUESTAS (FAQ)
  // =========================
  const FAQ = {
    direccion: "üìç Direcci√≥n:\nCostado Este del MaxiPal√≠, 25 varas al norte.",
    horario: "üïí Horario de atenci√≥n:\n" + HORARIO,
    matricula: "üíµ Matr√≠cula:\nLa informaci√≥n de matr√≠cula se brinda por WhatsApp para atenci√≥n personalizada.",
    mensualidad: "üìÖ Mensualidad:\nLa mensualidad es de C$ 1,450.",
    ofrece: "üéì ¬øQu√© ofrece el colegio?\nEducaci√≥n integral, formaci√≥n en valores, docentes capacitados y un ambiente seguro para nuestros estudiantes.",
    requisitos: "üìù Requisitos de matr√≠cula (general):\n‚Ä¢ Partida de nacimiento\n‚Ä¢ Bolet√≠n / notas\n‚Ä¢ Copia de c√©dula del encargado\n‚Ä¢ Foto tama√±o carnet\n(Para confirmar por grado, le atendemos por WhatsApp).",
    uniforme: "üëï Uniforme:\nPara detalles (camisa, pantal√≥n/falda, calzado) se confirma por WhatsApp seg√∫n el grado.",
    utiles: "üìö Lista de √∫tiles:\nLa lista var√≠a por grado. Escr√≠banos por WhatsApp y le enviamos la lista correspondiente.",
    actividades: "üèÖ Actividades / Eventos:\nContamos con actividades formativas, celebraciones, eventos y participaci√≥n estudiantil.\nSi desea el calendario del mes, p√≠dalo por WhatsApp.",
    calendario: "üóìÔ∏è Calendario escolar:\nPara fechas exactas (inicio, reuniones, actos) solic√≠telo por WhatsApp y se lo compartimos.",
    transporte: "üöå Transporte:\nPara rutas y disponibilidad, confirmamos por WhatsApp.",
    becas: "üéØ Becas / Descuentos:\nLa informaci√≥n depende de cupos y criterios del centro. Consulte por WhatsApp para evaluar su caso.",
    contacto: "üì≤ Contacto:\nAl continuar, se abrir√° WhatsApp para comunicarse directamente con el colegio."
  };

  const LABELS = {
    direccion: "Direcci√≥n",
    horario: "Horario",
    matricula: "Matr√≠cula",
    mensualidad: "Mensualidad",
    ofrece: "¬øQu√© ofrece?",
    requisitos: "Requisitos de matr√≠cula",
    uniforme: "Uniforme",
    utiles: "Lista de √∫tiles",
    actividades: "Actividades / Eventos",
    calendario: "Calendario escolar",
    transporte: "Transporte",
    becas: "Becas / Descuentos",
    contacto: "Contacto (WhatsApp)"
  };

  function suggestNext() {
    return "üòä ¬øEn qu√© m√°s podemos ayudarle?\nSeleccione otra opci√≥n o escriba su consulta.";
  }

  function closeBlessing() {
    return "‚ú® Bendiciones. Quedamos a su disposici√≥n.";
  }

  // =========================
  // SALUDO
  // =========================
  function greetOnce() {
    if (messages.dataset.greeted === "yes") return;
    messages.dataset.greeted = "yes";

    addBotMessage("üëã Bienvenido(a) al " + SITE_NAME + ".");
    addBotMessage("Soy " + BOT_NAME + ", su asistente virtual institucional.");
    addBotMessage("üïí Horario de atenci√≥n: " + HORARIO + ".");
    addBotMessage("üòä ¬øEn qu√© m√°s podemos ayudarle?");
  }

  function toggleChat(open) {
    const isOpen = chatBox.style.display === "block";
    const nextState = (open === undefined) ? !isOpen : open;
    chatBox.style.display = nextState ? "block" : "none";

    if (nextState) {
      greetOnce();
    } else {
      addBotMessage(closeBlessing());
    }
  }

  chatBtn.addEventListener("click", () => toggleChat());
  closeBtn.addEventListener("click", () => toggleChat(false));

  // =========================
  // OPCIONES: habilita bot√≥n y responde autom√°tico
  // =========================
  function getSelectedOption() {
    const selected = document.querySelector('input[name="menuOpt"]:checked');
    return selected ? selected.value : null;
  }

  function respondFromSelection(auto=false) {
    const type = getSelectedOption();
    if (!type) return;

    const label = LABELS[type] || type;
    if (!auto) addUserMessage(label);

    if (type === "contacto") {
      addBotMessage(FAQ[type]);
      openWhatsAppDirect();
      addBotMessage(closeBlessing());
      return;
    }

    addBotMessage(FAQ[type] || "No tengo esa informaci√≥n.");
    addBotMessage(suggestNext());
  }

  // Cuando cambie el radio: habilita bot√≥n y responde autom√°tico
  document.getElementById("menu").addEventListener("change", () => {
    answerBtn.disabled = false;

    // Respuesta autom√°tica inmediata (para que nunca falte el ‚Äúcontestar‚Äù)
    const type = getSelectedOption();
    if (!type) return;
    addUserMessage(LABELS[type] || type);
    respondFromSelection(true);
  });

  // Bot√≥n responder (por si lo quieren usar)
  answerBtn.addEventListener("click", () => {
    answerBtn.disabled = true;
    respondFromSelection(false);
  });

  // =========================
  // PREGUNTA ESCRITA / DICTADA
  // =========================
  function handleUserQuestion() {
    const question = (userInput.value || "").trim();
    if (!question) return;

    addUserMessage(question);
    userInput.value = "";

    const q = normalizeText(question);

    // reglas simples por palabras clave
    if (q.includes("direccion") || q.includes("ubicacion") || q.includes("donde")) {
      addBotMessage(FAQ.direccion); addBotMessage(suggestNext()); return;
    }
    if (q.includes("horario") || q.includes("hora")) {
      addBotMessage(FAQ.horario); addBotMessage(suggestNext()); return;
    }
    if (q.includes("mensualidad") || q.includes("cuota") || q.includes("pago mensual")) {
      addBotMessage(FAQ.mensualidad); addBotMessage(suggestNext()); return;
    }
    if (q.includes("matricula") || q.includes("inscripcion") || q.includes("inscripci√≥n")) {
      addBotMessage(FAQ.matricula); addBotMessage(suggestNext()); return;
    }
    if (q.includes("requisito") || q.includes("documento")) {
      addBotMessage(FAQ.requisitos); addBotMessage(suggestNext()); return;
    }
    if (q.includes("uniforme")) {
      addBotMessage(FAQ.uniforme); addBotMessage(suggestNext()); return;
    }
    if (q.includes("utiles") || q.includes("√∫tiles") || q.includes("lista")) {
      addBotMessage(FAQ.utiles); addBotMessage(suggestNext()); return;
    }
    if (q.includes("evento") || q.includes("actividad")) {
      addBotMessage(FAQ.actividades); addBotMessage(suggestNext()); return;
    }
    if (q.includes("transporte") || q.includes("ruta") || q.includes("bus")) {
      addBotMessage(FAQ.transporte); addBotMessage(suggestNext()); return;
    }
    if (q.includes("beca") || q.includes("descuento")) {
      addBotMessage(FAQ.becas); addBotMessage(suggestNext()); return;
    }
    if (q.includes("whatsapp") || q.includes("contacto") || q.includes("telefono") || q.includes("tel")) {
      addBotMessage(FAQ.contacto);
      openWhatsAppDirect();
      addBotMessage(closeBlessing());
      return;
    }

    // si no sabe -> WhatsApp directo al n√∫mero
    addBotMessage("Por el momento no tengo registrada esa informaci√≥n. Para una respuesta r√°pida, comun√≠quese por WhatsApp.");
    openWhatsAppDirect();
    addBotMessage(closeBlessing());
  }

  sendBtn.addEventListener("click", handleUserQuestion);
  userInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") handleUserQuestion();
  });

</script>

</body>
</html>
