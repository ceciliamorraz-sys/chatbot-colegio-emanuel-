<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>EmaBot</title>

  <style>
    :root{
      --brand:#1e4ed8;
      --brand2:#0ea5e9;
      --panel:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --line:#e2e8f0;
      --ok:#22c55e;
      --shadow:0 14px 38px rgba(2,6,23,.28);
      --radius:18px;
    }
    *{ box-sizing:border-box; }

    /* ‚úÖ Google Sites iframe: transparente + sin bloque oscuro */
    html, body{
      margin:0;
      padding:0;
      background: transparent !important;
      height:100%;
      overflow:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
    }

    /* =========================
       BOT√ìN FLOTANTE (OCULTO HASTA USAR)
       ========================= */
    .fab{
      position:fixed;
      right:10px;
      bottom:10px;
      display:flex;
      align-items:center;
      gap:10px;
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      color:white;
      border:none;
      border-radius:999px;
      padding:12px 14px;
      box-shadow: var(--shadow);
      cursor:pointer;
      font-weight:900;
      z-index:9999;
      user-select:none;
      transition: transform .12s ease, filter .12s ease;
      max-width: calc(100vw - 20px);
    }
    .fab:hover{ transform: translateY(-1px); filter: brightness(1.02); }
    .fab:active{ transform: translateY(0px); }

    .fab .logoWrap{
      width:34px; height:34px;
      border-radius:14px;
      background: rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.25);
      display:grid; place-items:center;
      overflow:hidden;
      flex:0 0 auto;
    }
    .fab img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .fab .txt{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-weight:900;
    }

    /* En iframes estrechos: solo icono/logo */
    @media (max-width: 420px){
      .fab .txt{ display:none; }
      .fab{ padding:12px; }
    }

    /* =========================
       WIDGET
       ========================= */
    .widget{
      position:fixed;
      right:10px;
      bottom:10px;
      width:min(420px, calc(100vw - 20px));
      background: var(--panel);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      z-index:10000;

      opacity:0;
      pointer-events:none;
      transform: translateY(10px);
      transition: opacity .18s ease, transform .18s ease;
    }
    .widget.open{
      opacity:1;
      pointer-events:auto;
      transform:none;
    }

    .topbar{
      padding:14px;
      color:white;
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .logo{
      width:38px; height:38px;
      border-radius:14px;
      background: rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.25);
      overflow:hidden;
      flex:0 0 auto;
      display:grid;
      place-items:center;
    }
    .logo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .title{
      min-width:0;
      line-height:1.05;
    }
    .title b{ display:block; font-size:14px; }
    .title small{
      display:flex; align-items:center; gap:6px;
      font-size:12px; opacity:.92;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .dot{
      width:8px; height:8px;
      border-radius:50%;
      background: var(--ok);
      box-shadow:0 0 0 4px rgba(34,197,94,.18);
      flex:0 0 auto;
    }

    .actions{ display:flex; gap:8px; align-items:center; }
    .iconbtn{
      width:32px; height:32px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.25);
      background: rgba(255,255,255,.12);
      color:white;
      cursor:pointer;
      display:grid; place-items:center;
      user-select:none;
      transition: transform .12s ease, background .12s ease;
    }
    .iconbtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.18); }

    .body{
      padding:14px;
      background: linear-gradient(180deg, #ffffff, #ffffff 62%, #f8fafc);
    }

    /* CHAT */
    .chat{
      height: 320px;
      overflow:auto;
      padding: 10px;
      background: #f8fafc;
      border:1px solid var(--line);
      border-radius: 16px;
    }
    .msg{ display:flex; margin:8px 0; }
    .msg.user{ justify-content:flex-end; }

    .bubble{
      max-width: 86%;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background:white;
      color: var(--text);
      box-shadow: 0 8px 18px rgba(2,6,23,.05);
      font-size: 13.5px;
      line-height: 1.35;
      white-space: pre-line;
    }
    .msg.bot .bubble{ border-left: 4px solid var(--brand); }
    .msg.user .bubble{
      background: linear-gradient(135deg, #dbeafe, #eef2ff);
      border-left: 4px solid #60a5fa;
    }

    .composer{
      display:flex;
      gap:10px;
      margin-top:10px;
      align-items:center;
    }
    input[type="text"]{
      flex:1;
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      font-size: 14px;
      outline:none;
      background:white;
      min-width:0;
    }
    input[type="text"]:focus{
      border-color:#93c5fd;
      box-shadow:0 0 0 4px rgba(147,197,253,.25);
    }
    .sendBtn{
      border:none;
      border-radius:14px;
      padding:12px 14px;
      cursor:pointer;
      font-weight:900;
      color:white;
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      box-shadow: 0 10px 22px rgba(2,6,23,.14);
      user-select:none;
      min-width:92px;
    }
    .sendBtn:hover{ filter: brightness(1.02); transform: translateY(-1px); }
    .sendBtn:active{ transform: translateY(0px); }

    /* FORM CORREO */
    .card{
      margin-top:12px;
      border:1px solid var(--line);
      background:white;
      border-radius:16px;
      padding:12px;
    }
    textarea{
      width:100%;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      margin-top:8px;
      font-size:14px;
      resize:vertical;
      min-height:90px;
      outline:none;
      background:white;
    }
    textarea:focus{
      border-color:#93c5fd;
      box-shadow:0 0 0 4px rgba(147,197,253,.25);
    }
    .mailBtn{
      margin-top:10px;
      width:100%;
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:900;
    }
    .mailBtn:hover{ background:#f1f5f9; }

    .note{
      margin-top:8px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }
  </style>
</head>

<body>

  <!-- Bot√≥n flotante -->
  <button class="fab" id="fab" aria-label="Abrir asistente">
    <span class="logoWrap">
      <img id="fabLogo" alt="Logo" />
    </span>
    <span class="txt">EmaBot</span>
  </button>

  <!-- Widget -->
  <div class="widget" id="widget" role="application" aria-label="EmaBot Asistente Virtual">
    <div class="topbar">
      <div class="brand">
        <div class="logo">
          <img id="headerLogo" alt="Logo del colegio" />
        </div>
        <div class="title">
          <b>EmaBot ‚Äì Asistente Virtual</b>
          <small><span class="dot" aria-hidden="true"></span><span id="schoolName">Colegio</span></small>
        </div>
      </div>

      <div class="actions">
        <button class="iconbtn" id="minBtn" title="Minimizar" aria-label="Minimizar">‚Äî</button>
        <button class="iconbtn" id="closeBtn" title="Cerrar" aria-label="Cerrar">‚úï</button>
      </div>
    </div>

    <div class="body">
      <div class="chat" id="chat" aria-live="polite"></div>

      <!-- TODO digitado -->
      <div class="composer">
        <input id="input" type="text" placeholder="Escribe tu consulta‚Ä¶" autocomplete="off"/>
        <button class="sendBtn" id="sendBtn">Enviar</button>
      </div>

      <!-- Formulario correo -->
      <div class="card">
        <b>‚úâÔ∏è Escribir por correo</b>
        <textarea id="mailMsg" placeholder="Escribe tu mensaje‚Ä¶"></textarea>
        <button class="mailBtn" id="mailBtn">Enviar correo</button>
        <div class="note">
          Si el asistente no puede resolver tu consulta, te enviar√° autom√°ticamente a WhatsApp para atenci√≥n directa.
        </div>
      </div>

      <div class="note">üè´ Este asistente brinda informaci√≥n general y no reemplaza la atenci√≥n directa del colegio.</div>
    </div>
  </div>

<script>
  const CONFIG = {
    schoolName: "Colegio Integral Emanuel",

    // ‚úÖ LOGO: pega aqu√≠ la URL del logo (ej: https://tusitio.com/logo.png)
    // Si lo subes junto al HTML en el mismo hosting, puedes usar: "logo.png"
    logoUrl: "PEGA_AQUI_URL_DEL_LOGO",

    // ‚úÖ Google Maps link
    mapLink: "PEGA_AQUI_TU_MAPLINK",

    // ‚úÖ WhatsApp / contacto
    whatsapp: "50558057682",
    phone: "58057682",

    // ‚úÖ correo del colegio
    email: "colegio@ejemplo.com",

    officeHours: "Lunes a Viernes | 7:00 a.m. ‚Äì 3:00 p.m."
  };

  const fab = document.getElementById("fab");
  const widget = document.getElementById("widget");
  const chat = document.getElementById("chat");
  const input = document.getElementById("input");

  // Logos + nombre
  document.getElementById("schoolName").textContent = CONFIG.schoolName;

  const fabLogo = document.getElementById("fabLogo");
  const headerLogo = document.getElementById("headerLogo");

  // Si no se configura el logo, usamos un emoji para evitar imagen rota
  function setLogo(){
    if(!CONFIG.logoUrl || CONFIG.logoUrl.includes("PEGA_AQUI")){
      // fallback: ocultar <img> y mostrar emoji
      fabLogo.style.display = "none";
      headerLogo.style.display = "none";

      // ponemos emoji en su contenedor
      fab.querySelector(".logoWrap").textContent = "üè´";
      document.querySelector(".logo").textContent = "üè´";
      return;
    }
    fabLogo.src = CONFIG.logoUrl;
    headerLogo.src = CONFIG.logoUrl;
  }
  setLogo();

  function openWidget(){
    widget.classList.add("open");
    fab.style.display = "none";
    greetOnce();
    setTimeout(()=>input.focus(), 60);
  }
  function hideWidget(){
    widget.classList.remove("open");
    fab.style.display = "flex";
  }

  fab.addEventListener("click", openWidget);
  document.getElementById("closeBtn").addEventListener("click", hideWidget);
  document.getElementById("minBtn").addEventListener("click", hideWidget);

  function addMsg(text, who="bot"){
    const row = document.createElement("div");
    row.className = "msg " + who;

    const safe = String(text).replace(/</g,"&lt;").replace(/>/g,"&gt;");
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.innerHTML = safe.replace(/\n/g,"<br/>");

    row.appendChild(bubble);
    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
  }

  let greeted = false;
  function greetOnce(){
    if(greeted) return;
    greeted = true;
    addMsg(
`üëã ¬°Bienvenido(a)! Soy EmaBot.
Puedes escribir tu consulta (m matr√≠cula, horarios, ubicaci√≥n, contacto, costos, requisitos, etc.).
Si no encuentro una respuesta segura, te enviar√© a WhatsApp ‚úÖ`
    );
  }

  function openWhatsApp(prefill){
    const url = `https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(prefill || "")}`;
    window.open(url, "_blank");
  }

  function escalateUnknown(userText){
    addMsg("üßë‚Äçüíº No encontr√© una respuesta segura. Te redirijo a WhatsApp para atenci√≥n directa ‚úÖ");
    const prefill = `Hola, necesito informaci√≥n del ${CONFIG.schoolName}.\nMi consulta fue: "${userText || "‚Äî"}"`;
    openWhatsApp(prefill);
  }

  // Respuestas b√°sicas por intenci√≥n (solo por texto digitado)
  function detectIntent(t){
    const s = (t||"").toLowerCase();

    if(s.includes("matri") || s.includes("inscrip") || s.includes("requis") || s.includes("cupo") || s.includes("pago") || s.includes("arancel") || s.includes("costo"))
      return "matricula";

    if(s.includes("hora") || s.includes("turno") || s.includes("atenc") || s.includes("entrada") || s.includes("salida"))
      return "horarios";

    if(s.includes("ubic") || s.includes("direc") || s.includes("map") || s.includes("como llegar") || s.includes("donde queda"))
      return "ubicacion";

    if(s.includes("contact") || s.includes("telefono") || s.includes("tel√©fono") || s.includes("whats") || s.includes("correo") || s.includes("email"))
      return "contacto";

    return "desconocido";
  }

  function respond(text){
    const intent = detectIntent(text);

    if(intent === "matricula"){
      addMsg(
`üìù Matr√≠cula
Ind√≠came el nivel (Preescolar / Primaria / Secundaria) y te gu√≠o.

En general se solicita:
‚Ä¢ Documentos del estudiante (partida/constancia seg√∫n aplique)
‚Ä¢ Documentos del tutor
‚Ä¢ R√©cord de notas (si viene de otro centro)
Si tu caso es espec√≠fico, puedo enviarte a WhatsApp para atenci√≥n directa.`
      );
      return;
    }

    if(intent === "horarios"){
      addMsg(`‚è∞ Horarios\nHorario de atenci√≥n: ${CONFIG.officeHours}\nSi necesitas horarios de clases por nivel, ind√≠came el nivel.`);
      return;
    }

    if(intent === "ubicacion"){
      if(!CONFIG.mapLink || CONFIG.mapLink.includes("PEGA_AQUI")){
        return escalateUnknown("Ubicaci√≥n (falta configurar Google Maps).");
      }
      addMsg(`üìç Ubicaci√≥n (Google Maps)\n${CONFIG.mapLink}\n¬øDeseas que te indique c√≥mo llegar desde tu zona?`);
      return;
    }

    if(intent === "contacto"){
      addMsg(
`üìû Contacto
Tel: ${CONFIG.phone}
WhatsApp: https://wa.me/${CONFIG.whatsapp}
Correo: ${CONFIG.email}`
      );
      return;
    }

    // ‚úÖ Si no sabe ‚Üí WhatsApp autom√°tico
    return escalateUnknown(text);
  }

  document.getElementById("sendBtn").addEventListener("click", () => {
    const t = input.value.trim();
    if(!t) return;
    addMsg(t, "user");
    input.value = "";
    respond(t);
  });

  input.addEventListener("keydown", (e) => {
    if(e.key === "Enter") document.getElementById("sendBtn").click();
  });

  // Form correo
  document.getElementById("mailBtn").addEventListener("click", () => {
    const msg = document.getElementById("mailMsg").value.trim();
    const subject = `Consulta ‚Äì ${CONFIG.schoolName}`;
    const body = msg || "Escriba aqu√≠ su consulta‚Ä¶";
    window.location.href =
      `mailto:${encodeURIComponent(CONFIG.email)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    addMsg("‚úâÔ∏è Listo. Se abrir√° tu correo para enviar el mensaje.");
  });

  // Inicia oculto siempre (solo bot√≥n flotante)
</script>

</body>
</html>
