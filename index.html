<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EmaBot - Colegio Integral Emanuel</title>

  <style>
    :root{
      --primary:#1f6feb;
      --bg:#f4f6fb;
      --card:#ffffff;
      --text:#1b1f24;
      --muted:#5b6572;
      --border:#e3e7ef;
      --shadow: 0 10px 28px rgba(0,0,0,.18);
      --radius:16px;
    }

    body{ font-family: Arial, sans-serif; margin:0; }

    /* Bot√≥n flotante */
    #chat-btn{
      position:fixed; right:18px; bottom:18px;
      width:62px; height:62px; border-radius:50%;
      border:none; cursor:pointer;
      background:var(--primary); color:#fff; font-size:26px;
      box-shadow: 0 8px 18px rgba(31,111,235,.35);
      z-index:999999;
      display:flex; align-items:center; justify-content:center;
    }

    /* Caja del chat */
    #chat-box{
      position:fixed; right:18px; bottom:92px;
      width:380px; height:560px;
      background:var(--card);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
      z-index:999999;
      display:none;
      border:1px solid rgba(0,0,0,.06);
    }

    #chat-header{
      background:var(--primary);
      color:#fff;
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    #chat-header .title{
      display:flex; align-items:center; gap:10px;
      font-weight:bold;
      min-width:0;
    }
    #chat-header .title span{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:220px;
      display:inline-block;
    }

    #chat-header .actions{
      display:flex; align-items:center; gap:10px;
    }
    #chat-header button{
      background:transparent; border:none; color:#fff;
      font-size:18px; cursor:pointer;
      width:34px; height:34px; border-radius:8px;
    }
    #chat-header button:hover{ background:rgba(255,255,255,.16); }

    #chat-messages{
      padding:12px;
      height:380px;
      overflow:auto;
      background:var(--bg);
    }

    .msg{
      max-width:92%;
      padding:10px 12px;
      border-radius:14px;
      margin:8px 0;
      line-height:1.25;
      word-wrap:break-word;
      border:1px solid rgba(0,0,0,.04);
    }
    .bot{
      background:#fff;
      color:var(--text);
      border-top-left-radius:6px;
    }
    .user{
      margin-left:auto;
      background:rgba(31,111,235,.10);
      border:1px solid rgba(31,111,235,.20);
      color:#0b2a61;
      border-top-right-radius:6px;
      text-align:right;
    }
    .muted{ color:var(--muted); font-size:12px; margin-top:6px; }

    /* Panel opciones (radio + continuar) */
    #options-panel{
      padding:10px 12px;
      background:#fff;
      border-top:1px solid var(--border);
    }
    .panel-title{
      background:#fff4e6;
      border:1px solid #ffd8a8;
      padding:10px 12px;
      border-radius:12px;
      font-weight:bold;
      margin-bottom:10px;
    }
    .radio-list{
      border:1px solid var(--border);
      border-radius:14px;
      padding:6px;
      background:#fff;
    }
    .radio-item{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 10px;
      border-radius:12px;
      cursor:pointer;
    }
    .radio-item:hover{ background:#f7f9ff; }
    .radio-item input{ transform:scale(1.1); }
    .radio-item .label{ flex:1; }
    .radio-item .emoji{ width:24px; text-align:center; }

    .btn-row{
      display:flex;
      gap:10px;
      margin-top:10px;
    }
    .btn{
      flex:1;
      border:none;
      cursor:pointer;
      border-radius:12px;
      padding:12px 12px;
      font-weight:bold;
    }
    .btn-primary{
      background:var(--primary);
      color:#fff;
    }
    .btn-outline{
      background:#fff;
      color:var(--primary);
      border:1px solid rgba(31,111,235,.35);
    }

    /* Input + enviar */
    #chat-input-area{
      display:flex;
      gap:10px;
      padding:12px;
      background:#fff;
      border-top:1px solid var(--border);
    }
    #chat-input{
      flex:1;
      padding:12px 12px;
      border:1px solid var(--border);
      border-radius:12px;
      outline:none;
      font-size:14px;
    }
    #send-btn{
      padding:12px 14px;
      border:none;
      border-radius:12px;
      background:var(--primary);
      color:#fff;
      cursor:pointer;
      font-weight:bold;
    }
    #send-btn:hover{ filter:brightness(.95); }

    /* Responsive: m√≥vil */
    @media (max-width:520px){
      #chat-box{
        right:10px; left:10px;
        bottom:86px;
        width:auto;
        height:72vh;
      }
      #chat-messages{ height:calc(72vh - 56px - 170px); }
      #chat-header .title span{ max-width:190px; }
    }
  </style>
</head>

<body>

  <!-- Bot√≥n flotante -->
  <button id="chat-btn" aria-label="Abrir EmaBot">üí¨</button>

  <!-- Chat -->
  <div id="chat-box" role="dialog" aria-label="EmaBot - Colegio Integral Emanuel">
    <div id="chat-header">
      <div class="title">
        <span>ü§ñ EmaBot ‚Äì Colegio Integral Emanuel</span>
      </div>
      <div class="actions">
        <button id="voice-btn" title="Voz (habla)" aria-label="Voz">üîä</button>
        <button id="close-btn" title="Cerrar" aria-label="Cerrar">‚úï</button>
      </div>
    </div>

    <div id="chat-messages"></div>

    <div id="options-panel">
      <div class="panel-title">Seleccione una opci√≥n:</div>

      <div class="radio-list" id="radio-list">
        <label class="radio-item">
          <input type="radio" name="op" value="direccion">
          <div class="emoji">üìç</div>
          <div class="label">Direcci√≥n</div>
        </label>

        <label class="radio-item">
          <input type="radio" name="op" value="matricula">
          <div class="emoji">üßæ</div>
          <div class="label">Matr√≠cula</div>
        </label>

        <label class="radio-item">
          <input type="radio" name="op" value="mensualidad">
          <div class="emoji">üí≥</div>
          <div class="label">Mensualidad</div>
        </label>

        <label class="radio-item">
          <input type="radio" name="op" value="horario">
          <div class="emoji">‚è∞</div>
          <div class="label">Horario</div>
        </label>

        <label class="radio-item">
          <input type="radio" name="op" value="ofrece">
          <div class="emoji">üéì</div>
          <div class="label">¬øQu√© ofrece?</div>
        </label>

        <label class="radio-item">
          <input type="radio" name="op" value="requisitos">
          <div class="emoji">‚úÖ</div>
          <div class="label">Requisitos de inscripci√≥n</div>
        </label>

        <label class="radio-item">
          <input type="radio" name="op" value="uniforme">
          <div class="emoji">üëï</div>
          <div class="label">Uniforme</div>
        </label>

        <label class="radio-item">
          <input type="radio" name="op" value="contacto">
          <div class="emoji">üìù</div>
          <div class="label">Formulario de contacto</div>
        </label>
      </div>

      <div class="btn-row">
        <button class="btn btn-outline" id="help-btn" type="button">¬øEn qu√© m√°s?</button>
        <button class="btn btn-primary" id="continue-btn" type="button">Continuar</button>
      </div>

      <div class="muted">
        Tip: En tel√©fono, la voz solo funciona despu√©s de tocar el bot√≥n üîä o abrir el chat.
      </div>
    </div>

    <div id="chat-input-area">
      <input id="chat-input" type="text" placeholder="Escribe tu pregunta aqu√≠..." />
      <button id="send-btn" type="button">Enviar</button>
    </div>
  </div>

  <script>
    /*********************
     * CONFIGURACI√ìN
     *********************/
    const WHATSAPP_NUMBER = "58753725"; // tu n√∫mero
    const SCHOOL_NAME = "Colegio Integral Emanuel";

    // Respuestas (ajusta lo que necesites)
    const FAQ = {
      direccion: "üìç Direcci√≥n: Costado Este del MaxiPali, 25 varas al norte.",
      matricula: "üßæ Matr√≠cula: Para informaci√≥n de costos y cupos disponibles, cont√°ctanos y con gusto te atendemos.",
      mensualidad: "üí≥ Mensualidad: Var√≠a seg√∫n el nivel. Escr√≠benos y te compartimos la informaci√≥n actualizada.",
      horario: "‚è∞ Horario de atenci√≥n: Lunes a Viernes, 7:00 a.m. a 3:00 p.m.",
      ofrece: "üéì Ofrecemos educaci√≥n integral, formaci√≥n en valores, docentes capacitados y acompa√±amiento acad√©mico.",
      requisitos: "‚úÖ Requisitos de inscripci√≥n: Copia de partida de nacimiento, copia de c√©dula del tutor, r√©cord de notas/traslado (si aplica) y completar ficha de matr√≠cula.",
      uniforme: "üëï Uniforme: Consulta el modelo y colores oficiales por WhatsApp para enviarte la gu√≠a actualizada.",
    };

    /*********************
     * VOZ (TTS)
     *********************/
    let voiceEnabled = false;
    let greetedOnce = false;

    function speak(text){
      if (!voiceEnabled) return;
      if (!("speechSynthesis" in window)) return;

      const u = new SpeechSynthesisUtterance(text);
      u.lang = "es-ES";
      u.rate = 1;
      u.pitch = 1;

      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    }

    /*********************
     * UI HELPERS
     *********************/
    const chatBtn = document.getElementById("chat-btn");
    const chatBox = document.getElementById("chat-box");
    const closeBtn = document.getElementById("close-btn");
    const voiceBtn = document.getElementById("voice-btn");
    const chatMessages = document.getElementById("chat-messages");
    const chatInput = document.getElementById("chat-input");
    const sendBtn = document.getElementById("send-btn");
    const continueBtn = document.getElementById("continue-btn");
    const helpBtn = document.getElementById("help-btn");

    function addMessage(text, who="bot"){
      const div = document.createElement("div");
      div.className = "msg " + (who === "user" ? "user" : "bot");
      div.textContent = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      if (who === "bot") speak(text);
    }

    function openChat(){
      chatBox.style.display = "block";

      // Saludo SOLO una vez (y con voz si ya estaba activada o si el usuario activar√° luego)
      if (!window.__ema_inited){
        window.__ema_inited = true;
        addMessage("üëã Bienvenido(a) al " + SCHOOL_NAME + ".");
        addMessage("Soy EmaBot, su asistente virtual institucional.");
        addMessage("‚è∞ Horario de atenci√≥n: Lunes a Viernes, 7:00 a.m. a 3:00 p.m.");
        addMessage("üòä ¬øEn qu√© m√°s podemos ayudarle?");
      }

      // Si ya est√° la voz activada, saluda con voz aqu√≠ (solo una vez)
      if (voiceEnabled && !greetedOnce){
        greetedOnce = true;
        speak("Hola, soy EmaBot. Bienvenido al " + SCHOOL_NAME + ". ¬øEn qu√© m√°s podemos ayudarle?");
      }
    }

    function closeChat(){
      chatBox.style.display = "none";
    }

    function getSelectedOption(){
      const checked = document.querySelector('input[name="op"]:checked');
      return checked ? checked.value : null;
    }

    function openWhatsApp(text){
      const msg = encodeURIComponent(text);
      // wa.me directo al n√∫mero
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`;
      window.open(url, "_blank");
    }

    /*********************
     * L√ìGICA DEL BOT
     *********************/
    function handleOption(option){
      if (!option){
        addMessage("Por favor seleccione una opci√≥n y toque ‚ÄúContinuar‚Äù, o escriba su pregunta.");
        return;
      }

      if (option === "contacto"){
        showContactForm();
        return;
      }

      const ans = FAQ[option];
      if (ans){
        addMessage(ans);
        addMessage("‚ú® Bendiciones. Quedamos a su disposici√≥n.");
      }else{
        const fallback = "No tengo esa informaci√≥n en este momento. ¬øDesea escribirnos por WhatsApp para atenderle mejor?";
        addMessage(fallback);
        openWhatsApp("Hola, necesito informaci√≥n del Colegio Integral Emanuel. Mi consulta es: " + option);
      }
    }

    function handleTextQuestion(q){
      const text = (q || "").trim();
      if (!text) return;

      addMessage(text, "user");

      const lower = text.toLowerCase();

      // Mini-intents simples (puedes ampliar)
      if (lower.includes("direccion") || lower.includes("direcci√≥n")){
        addMessage(FAQ.direccion);
        addMessage("‚ú® Bendiciones. Quedamos a su disposici√≥n.");
        return;
      }
      if (lower.includes("matricula") || lower.includes("matr√≠cula") || lower.includes("inscrib")){
        addMessage(FAQ.requisitos);
        addMessage("üßæ Si desea, tambi√©n puedo orientarle sobre matr√≠cula.");
        addMessage("‚ú® Bendiciones. Quedamos a su disposici√≥n.");
        return;
      }
      if (lower.includes("mensual") || lower.includes("pago") || lower.includes("cuota")){
        addMessage(FAQ.mensualidad);
        addMessage("‚ú® Bendiciones. Quedamos a su disposici√≥n.");
        return;
      }
      if (lower.includes("horario") || lower.includes("atienden") || lower.includes("hora")){
        addMessage(FAQ.horario);
        addMessage("‚ú® Bendiciones. Quedamos a su disposici√≥n.");
        return;
      }
      if (lower.includes("uniforme")){
        addMessage(FAQ.uniforme);
        addMessage("‚ú® Bendiciones. Quedamos a su disposici√≥n.");
        return;
      }

      // Si no sabe: manda a WhatsApp directo
      addMessage("Para darle una respuesta correcta, por favor escr√≠banos por WhatsApp y con gusto le atendemos. ‚úÖ");
      openWhatsApp("Hola, necesito ayuda. Pregunta: " + text);
    }

    /*********************
     * FORMULARIO DE CONTACTO (simple)
     *********************/
    function showContactForm(){
      addMessage("üìù Formulario de contacto:");
      addMessage("1) Escriba su nombre, 2) tel√©fono, 3) su consulta. Luego presione Enviar.");

      // Plantilla r√°pida en el input
      chatInput.value = "Nombre: \nTel√©fono: \nConsulta: ";
      chatInput.focus();
    }

    /*********************
     * EVENTOS
     *********************/
    chatBtn.addEventListener("click", () => {
      openChat();

      // En m√≥vil, si quieres ‚Äúsaludo con voz‚Äù al abrir,
      // primero el usuario toc√≥ el bot√≥n, as√≠ que ya es v√°lido.
      // Solo se reproduce si la voz est√° activada:
      if (voiceEnabled && !greetedOnce){
        greetedOnce = true;
        speak("Hola, soy EmaBot. Bienvenido al " + SCHOOL_NAME + ". ¬øEn qu√© m√°s podemos ayudarle?");
      }
    });

    closeBtn.addEventListener("click", closeChat);

    voiceBtn.addEventListener("click", () => {
      voiceEnabled = !voiceEnabled;
      // cambia icono
      voiceBtn.textContent = voiceEnabled ? "üîä" : "üîá";

      addMessage(voiceEnabled
        ? "Voz activada ‚úÖ"
        : "Voz desactivada ‚úÖ"
      );

      // Saludo con voz la primera vez que se activa
      if (voiceEnabled && !greetedOnce){
        greetedOnce = true;
        speak("Hola, soy EmaBot. Bienvenido al " + SCHOOL_NAME + ". ¬øEn qu√© m√°s podemos ayudarle?");
      }
    });

    continueBtn.addEventListener("click", () => {
      handleOption(getSelectedOption());
    });

    helpBtn.addEventListener("click", () => {
      addMessage("üòä Puede seleccionar una opci√≥n y tocar ‚ÄúContinuar‚Äù, o escribir su pregunta abajo.");
    });

    sendBtn.addEventListener("click", () => {
      handleTextQuestion(chatInput.value);
      chatInput.value = "";
    });

    chatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter"){
        e.preventDefault();
        sendBtn.click();
      }
    });

    // Si el usuario selecciona un radio, opcionalmente auto-responder (si lo quieres)
    // descomenta para que responda sin ‚ÄúContinuar‚Äù
    /*
    document.getElementById("radio-list").addEventListener("change", () => {
      handleOption(getSelectedOption());
    });
    */
  </script>
</body>
</html>

