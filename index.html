<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EmaBot ‚Äì Asistente Virtual</title>

<style>
:root{
  --primary:#1e5bd8;
  --primary2:#0f3aa6;
  --bg:#f4f7ff;
  --card:#ffffff;
  --line:#e6eaf3;
  --text:#1b1f2a;
  --radius:16px;
  --shadow:0 12px 30px rgba(16,40,120,.14);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
}

/* Bot√≥n flotante */
#fab{
  position:fixed;
  right:18px;bottom:18px;
  width:56px;height:56px;
  border-radius:50%;
  border:none;
  background:var(--primary);
  color:#fff;
  font-size:22px;
  cursor:pointer;
  box-shadow:var(--shadow);
  z-index:9999;
}

/* Chat */
#chat{
  position:fixed;
  right:18px;bottom:86px;
  width:min(380px,calc(100vw - 36px));
  height:72vh;max-height:640px;
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  border:1px solid var(--line);
  display:none;
  overflow:hidden;
  z-index:9999;
}
#chat.open{display:block}

header{
  background:linear-gradient(135deg,var(--primary),var(--primary2));
  color:#fff;
  padding:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header .title{
  font-weight:700;
  font-size:14px;
}
header .sub{
  font-size:12px;
  opacity:.9;
}
header button{
  background:rgba(255,255,255,.2);
  border:none;
  color:#fff;
  border-radius:8px;
  width:34px;height:34px;
  cursor:pointer;
}

#body{
  background:var(--bg);
  padding:14px;
  height:calc(100% - 56px - 64px);
  overflow:auto;
}

.bubble{
  background:#fff;
  border:1px solid var(--line);
  border-radius:14px;
  padding:10px 12px;
  margin:8px 0;
  max-width:92%;
  box-shadow:0 6px 14px rgba(0,0,0,.06);
  font-size:14px;
  line-height:1.35;
}
.user{
  margin-left:auto;
  background:#eaf1ff;
}

.panel{
  background:#fff;
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px;
  margin:12px 0;
}
.panel button{
  width:100%;
  margin:4px 0;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--line);
  background:#fff;
  cursor:pointer;
  font-weight:600;
}

footer{
  display:flex;
  gap:10px;
  padding:10px;
  border-top:1px solid var(--line);
}
footer input{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--line);
}
footer button{
  padding:10px 14px;
  border-radius:10px;
  border:none;
  background:var(--primary);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>

<body>

<button id="fab">üí¨</button>

<section id="chat">
<header>
  <div>
    <div class="title">EmaBot ‚Äì Asistente Virtual</div>
    <div class="sub">Colegio Integral Emanuel</div>
  </div>
  <div>
    <button id="voiceBtn">üéôÔ∏è</button>
    <button id="stopBtn">‚èπÔ∏è</button>
    <button id="closeBtn">‚úï</button>
  </div>
</header>

<div id="body"></div>

<footer>
  <input id="input" placeholder="Escriba su consulta aqu√≠‚Ä¶">
  <button id="sendBtn">Enviar</button>
</footer>
</section>

<script>
/* ===== DATOS DEL COLEGIO ===== */
const SCHOOL={
  name:"Colegio Integral Emanuel",
  phone:"8853-3012",
  email:"colegiointegralemanuel@gmail.com",
  hours:"Lunes a Viernes | 7:00 a.m. ‚Äì 3:00 p.m.",
  city:"Matagalpa, Nicaragua",
  maps:"https://www.google.com/maps/search/?api=1&query=Colegio+Integral+Emanuel+Matagalpa"
};

const chat=document.getElementById("chat");
const body=document.getElementById("body");
const fab=document.getElementById("fab");
const closeBtn=document.getElementById("closeBtn");
const input=document.getElementById("input");
const sendBtn=document.getElementById("sendBtn");
const voiceBtn=document.getElementById("voiceBtn");
const stopBtn=document.getElementById("stopBtn");

let voiceEnabled=false;

/* ===== VOZ ===== */
function speak(text){
  if(!voiceEnabled) return;
  if(!("speechSynthesis" in window)) return;
  const u=new SpeechSynthesisUtterance(text);
  u.lang="es-ES";
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}

/* ===== UTILIDADES ===== */
function addBubble(text,user=false){
  const b=document.createElement("div");
  b.className="bubble"+(user?" user":"");
  b.innerHTML=text;
  body.appendChild(b);
  body.scrollTop=body.scrollHeight;
  if(!user) speak(b.innerText);
}

/* ===== INICIO ===== */
function openChat(){
  chat.classList.add("open");
  fab.style.display="none";
  if(body.childElementCount===0){
    addBubble(
      `<b>üëã Bienvenido(a) al asistente virtual del ${SCHOOL.name}.</b><br><br>
       ‚è∞ <b>Horario de atenci√≥n:</b><br>${SCHOOL.hours}<br><br>
       Seleccione una opci√≥n o escriba su consulta.`
    );
    showMenu();
  }
}
function closeChat(){
  chat.classList.remove("open");
  fab.style.display="block";
  window.speechSynthesis.cancel();
}

/* ===== MEN√ö ===== */
function showMenu(){
  const p=document.createElement("div");
  p.className="panel";
  p.innerHTML=`
    <button onclick="reply('matricula')">üìù Matr√≠cula</button>
    <button onclick="reply('horarios')">‚è∞ Horarios</button>
    <button onclick="reply('ubicacion')">üìç Ubicaci√≥n</button>
    <button onclick="reply('ofertas')">üìö Ofertas Acad√©micas</button>
    <button onclick="reply('contacto')">üìû Contacto</button>
    <div style="font-size:12px;margin-top:8px">üéß Presione üéôÔ∏è para activar voz</div>
  `;
  body.appendChild(p);
}

/* ===== RESPUESTAS ===== */
window.reply=function(type){
  if(type==="matricula"){
    addBubble(`üìù Para matr√≠cula comun√≠quese al <b>${SCHOOL.phone}</b>.`);
  }
  if(type==="horarios"){
    addBubble(`‚è∞ Atenci√≥n administrativa:<br>${SCHOOL.hours}`);
  }
  if(type==="ubicacion"){
    addBubble(`üìç ${SCHOOL.city}<br><a href="${SCHOOL.maps}" target="_blank">Ver en Google Maps</a>`);
  }
  if(type==="ofertas"){
    addBubble(`üìö Preescolar, Primaria, Ingl√©s diario y Tecnolog√≠a Educativa.`);
  }
  if(type==="contacto"){
    addBubble(`üìû ${SCHOOL.phone}<br>üìß ${SCHOOL.email}`);
  }
};

/* ===== EVENTOS ===== */
fab.onclick=openChat;
closeBtn.onclick=closeChat;

sendBtn.onclick=()=>{
  if(input.value.trim()){
    addBubble(input.value,true);
    input.value="";
    addBubble("Gracias por su mensaje. En breve le atendemos.");
  }
};

voiceBtn.onclick=()=>{
  voiceEnabled=true;
  localStorage.setItem("emabot_voice","1");
  speak("La voz ha sido activada. Bienvenido al Colegio Integral Emanuel.");
};

stopBtn.onclick=()=>window.speechSynthesis.cancel();

/* ===== RECORDAR VOZ ===== */
if(localStorage.getItem("emabot_voice")==="1"){
  voiceEnabled=true;
}

/* ===== ABRIR AUTOM√ÅTICO ===== */
window.addEventListener("load",()=>{
  setTimeout(openChat,600);
});
</script>

</body>
</html>
