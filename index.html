<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>EmaBot Widget</title>

<style>
:root{
  --brand:#1e4ed8;
  --brand2:#0ea5e9;
  --panel:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --line:#e2e8f0;
  --soft:#f1f5f9;
  --ok:#22c55e;
  --shadow:0 14px 38px rgba(2,6,23,.28);
  --radius:18px;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#0b1220;min-height:100vh}

/* BOT√ìN FLOTANTE (SIEMPRE VISIBLE) */
.fab{
  position:fixed;right:18px;bottom:18px;
  display:flex;align-items:center;gap:10px;
  background:linear-gradient(135deg,var(--brand),var(--brand2));
  color:white;border:none;border-radius:999px;
  padding:12px 14px;box-shadow:var(--shadow);
  cursor:pointer;font-weight:900;z-index:9999;
  user-select:none;
  transition:transform .12s ease, filter .12s ease;
}
.fab:hover{transform:translateY(-1px);filter:brightness(1.02)}
.fab .ico{
  width:34px;height:34px;border-radius:14px;
  background:rgba(255,255,255,.14);
  display:grid;place-items:center;
  border:1px solid rgba(255,255,255,.25);
}

/* WIDGET (OCULTO POR DEFECTO) */
.widget{
  position:fixed;right:18px;bottom:18px;
  width:min(420px,calc(100vw - 36px));
  background:var(--panel);border-radius:var(--radius);
  box-shadow:var(--shadow);overflow:hidden;
  opacity:0;pointer-events:none;
  transform:translateY(10px);
  transition:opacity .18s ease, transform .18s ease;
  z-index:10000;
}
.widget.open{opacity:1;pointer-events:auto;transform:none}

.topbar{
  padding:14px;color:white;
  background:linear-gradient(135deg,var(--brand),var(--brand2));
  display:flex;justify-content:space-between;align-items:center;
  gap:10px;
}
.brand{display:flex;gap:10px;align-items:center;min-width:0}
.avatar{
  width:36px;height:36px;border-radius:14px;
  background:rgba(255,255,255,.18);
  display:grid;place-items:center;
  border:1px solid rgba(255,255,255,.25);
}
.title{min-width:0;line-height:1.05}
.title b{display:block;font-size:14px}
.title small{
  font-size:12px;opacity:.92;
  display:flex;gap:6px;align-items:center;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.dot{width:8px;height:8px;border-radius:50%;background:var(--ok)}

.iconbtn{
  width:32px;height:32px;border-radius:12px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.12);
  color:white;cursor:pointer;
  user-select:none;
  transition:transform .12s ease, background .12s ease;
}
.iconbtn:hover{transform:translateY(-1px);background:rgba(255,255,255,.18)}

.body{padding:14px;background:#f8fafc}

/* CHAT */
.chat{
  height:300px;overflow:auto;padding:10px;
  border:1px solid var(--line);
  border-radius:16px;background:white;
}
.msg{margin:8px 0;display:flex}
.msg.user{justify-content:flex-end}
.bubble{
  max-width:85%;padding:10px 12px;
  border-radius:14px;border:1px solid var(--line);
  background:white;font-size:13.5px;line-height:1.35;
  white-space:pre-line;
}
.msg.bot .bubble{border-left:4px solid var(--brand)}
.msg.user .bubble{background:#eef2ff;border-left:4px solid #60a5fa}

.row{display:flex;gap:10px;margin-top:10px}
.btn{
  flex:1;border:1px solid var(--line);
  border-radius:14px;padding:10px;
  background:white;font-weight:900;cursor:pointer;
  user-select:none;
  transition:transform .12s ease, background .12s ease, border-color .12s ease;
  min-height:44px;
}
.btn:hover{transform:translateY(-1px);background:#f1f5f9;border-color:#cbd5e1}
.btn.primary{
  background:linear-gradient(135deg,var(--brand),var(--brand2));
  color:white;border:none;
}
.btn.danger{
  background:linear-gradient(135deg,#ef4444,#f97316);
  color:white;border:none;
}

.composer{display:flex;gap:10px;margin-top:10px}
input{
  flex:1;border:1px solid var(--line);
  border-radius:14px;padding:12px;font-size:14px;
  outline:none;background:white;
}
input:focus{border-color:#93c5fd;box-shadow:0 0 0 4px rgba(147,197,253,.25)}

.card{
  margin-top:12px;border:1px solid var(--line);
  border-radius:16px;padding:12px;background:white
}
textarea{
  width:100%;border:1px solid var(--line);
  border-radius:14px;padding:12px;margin-top:8px;
  font-size:14px;resize:vertical;min-height:90px;
}
textarea:focus{border-color:#93c5fd;box-shadow:0 0 0 4px rgba(147,197,253,.25);outline:none}

.note{margin-top:8px;color:var(--muted);font-size:12px;line-height:1.35}
</style>
</head>

<body>

<!-- BOT√ìN: el asistente est√° OCULTO hasta que presionen este bot√≥n -->
<button class="fab" id="fab" aria-label="Abrir asistente">
  <span class="ico">ü§ñ</span>
  <span>EmaBot</span>
</button>

<!-- WIDGET -->
<div class="widget" id="widget" role="application" aria-label="EmaBot Asistente Virtual">
  <div class="topbar">
    <div class="brand">
      <div class="avatar" aria-hidden="true">ü§ñ</div>
      <div class="title">
        <b>EmaBot ‚Äì Asistente Virtual</b>
        <small><span class="dot" aria-hidden="true"></span> Colegio Integral Emanuel</small>
      </div>
    </div>
    <div>
      <button class="iconbtn" id="min" title="Minimizar" aria-label="Minimizar">‚Äî</button>
      <button class="iconbtn" id="close" title="Cerrar" aria-label="Cerrar">‚úï</button>
    </div>
  </div>

  <div class="body">

    <div class="chat" id="chat" aria-live="polite"></div>

    <div class="row">
      <button class="btn" data-action="matricula">üìù Matr√≠cula</button>
      <button class="btn" data-action="horarios">‚è∞ Horarios</button>
    </div>
    <div class="row">
      <button class="btn" data-action="ubicacion">üìç Ubicaci√≥n</button>
      <button class="btn" data-action="contacto">üìû Contacto</button>
    </div>
    <div class="row">
      <button class="btn danger" data-action="humano">üí¨ WhatsApp</button>
    </div>

    <div class="composer">
      <input id="input" placeholder="Escribe tu consulta‚Ä¶"/>
      <button class="btn primary" id="send">Enviar</button>
    </div>

    <!-- Formulario correo -->
    <div class="card">
      <b>‚úâÔ∏è Escribir por correo</b>
      <textarea id="mailMsg" placeholder="Escribe tu mensaje‚Ä¶"></textarea>
      <button class="btn" id="mailBtn">Enviar correo</button>
      <div class="note">
        Esto abre tu app de correo (Gmail/Outlook). Si el asistente no puede resolver tu duda, te enviar√° a WhatsApp autom√°ticamente.
      </div>
    </div>

    <div class="note">üè´ Este asistente brinda informaci√≥n general y no reemplaza la atenci√≥n directa del colegio.</div>
  </div>
</div>

<script>
const CONFIG = {
  // ‚úÖ Pega aqu√≠ tu enlace real de Google Maps
  mapLink: "PEGA_AQUI_TU_MAPLINK",

  // ‚úÖ WhatsApp/Contacto (Nicaragua: +505 recomendado)
  whatsapp: "50558057682",
  phone: "58057682",

  // ‚úÖ Correo del colegio (c√°mbialo)
  email: "colegio@ejemplo.com",

  schoolName: "Colegio Integral Emanuel"
};

const fab = document.getElementById("fab");
const widget = document.getElementById("widget");
const chat = document.getElementById("chat");
const input = document.getElementById("input");

fab.onclick = () => {
  widget.classList.add("open");
  fab.style.display = "none";
  greetOnce();
  setTimeout(()=> input.focus(), 50);
};
document.getElementById("close").onclick = () => {
  widget.classList.remove("open");
  fab.style.display = "flex";
};
document.getElementById("min").onclick = () => {
  widget.classList.remove("open");
  fab.style.display = "flex";
};

function add(text, who="bot"){
  const d = document.createElement("div");
  d.className = "msg " + who;
  const safe = String(text).replace(/</g,"&lt;").replace(/>/g,"&gt;");
  d.innerHTML = `<div class="bubble">${safe}</div>`;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

let greeted = false;
function greetOnce(){
  if(greeted) return;
  greeted = true;
  add(`üëã ¬°Bienvenido(a)! Soy EmaBot.\nPuedo brindarte informaci√≥n general del colegio.\nSi no encuentro una respuesta segura, te enviar√© a WhatsApp ‚úÖ`);
}

function openWhatsApp(prefill){
  const url = `https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(prefill || "")}`;
  window.open(url, "_blank");
}

function escalateUnknown(userText){
  add("üßë‚Äçüíº No encontr√© una respuesta segura. Te redirijo a WhatsApp para atenci√≥n directa ‚úÖ");
  const prefill = `Hola, necesito informaci√≥n del ${CONFIG.schoolName}.\nMi consulta fue: "${userText || "‚Äî"}"`;
  openWhatsApp(prefill);
}

function respond(text){
  const t = (text || "").toLowerCase();

  // Respuestas b√°sicas (ajusta a tus datos reales)
  if(t.includes("matri") || t === "matricula"){
    add("üìù Matr√≠cula: Ind√≠came el nivel (Preescolar, Primaria o Secundaria) y te gu√≠o con requisitos y pasos.");
    return;
  }
  if(t.includes("hora") || t === "horarios"){
    add("‚è∞ Horario de atenci√≥n: Lunes a Viernes 7:00 a.m. ‚Äì 3:00 p.m.");
    return;
  }
  if(t.includes("ubi") || t.includes("map") || t === "ubicacion"){
    if(!CONFIG.mapLink || CONFIG.mapLink.includes("PEGA_AQUI")){
      return escalateUnknown("Ubicaci√≥n (falta configurar el enlace de Google Maps).");
    }
    add(`üìç Ubicaci√≥n (Google Maps):\n${CONFIG.mapLink}`);
    return;
  }
  if(t.includes("contac") || t === "contacto"){
    add(`üìû Contacto:\nTel: ${CONFIG.phone}\nWhatsApp: https://wa.me/${CONFIG.whatsapp}\nCorreo: ${CONFIG.email}`);
    return;
  }
  if(t === "humano" || t.includes("whatsapp") || t.includes("admin")){
    return openWhatsApp(`Hola, necesito informaci√≥n del ${CONFIG.schoolName}.`);
  }

  // ‚úÖ Si no sabe ‚Üí WhatsApp autom√°tico
  return escalateUnknown(text);
}

document.getElementById("send").onclick = () => {
  const t = input.value.trim();
  if(!t) return;
  add(t, "user");
  input.value = "";
  respond(t);
};

document.querySelectorAll("[data-action]").forEach(btn=>{
  btn.onclick = () => respond(btn.dataset.action);
});

document.getElementById("mailBtn").onclick = () => {
  const msg = document.getElementById("mailMsg").value.trim();
  const subject = `Consulta ‚Äì ${CONFIG.schoolName}`;
  const body = msg || "Escriba aqu√≠ su consulta‚Ä¶";
  window.location.href = `mailto:${encodeURIComponent(CONFIG.email)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  add("‚úâÔ∏è Listo. Se abrir√° tu correo para enviar el mensaje.");
};
</script>

</body>
</html>
