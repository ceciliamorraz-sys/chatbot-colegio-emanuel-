<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EmaBot - Colegio Integral Emanuel</title>

  <style>
    body { font-family: Arial, sans-serif; }

    /* Bot√≥n flotante */
    #chat-btn{
      position: fixed;
      bottom: 18px;
      right: 18px;
      background:#1f6feb;
      color:#fff;
      border:none;
      border-radius:50%;
      width:60px;
      height:60px;
      font-size:26px;
      cursor:pointer;
      box-shadow:0 6px 16px rgba(0,0,0,.25);
      z-index:999999;
    }

    /* Caja del chat (responsive) */
    #chat-box{
      display:none;
      position: fixed;
      bottom: 90px;
      right: 18px;
      width: 360px;
      max-width: calc(100vw - 36px);
      height: 520px;
      max-height: calc(100vh - 140px);
      background:#fff;
      border-radius:16px;
      box-shadow:0 10px 25px rgba(0,0,0,.22);
      overflow:hidden;
      z-index:999999;
    }

    /* En m√≥vil, que sea ‚Äúcasi pantalla completa‚Äù */
    @media (max-width: 520px){
      #chat-box{
        right: 10px;
        left: 10px;
        width: auto;
        bottom: 90px;
        height: 72vh;
        max-height: 72vh;
      }
      #chat-btn{
        right: 14px;
        bottom: 14px;
      }
    }

    #chat-header{
      background:#1f6feb;
      color:#fff;
      padding:12px 14px;
      font-weight:bold;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    #chat-header .left{
      display:flex;
      align-items:center;
      gap:10px;
      overflow:hidden;
    }
    #chat-header .title{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 240px;
    }
    #chat-header .actions{
      display:flex;
      align-items:center;
      gap:8px;
    }
    #chat-header button{
      background:transparent;
      border:none;
      color:#fff;
      cursor:pointer;
      font-size:18px;
      padding:6px;
      border-radius:8px;
    }
    #chat-header button:hover{ background:rgba(255,255,255,.15); }

    #chat-messages{
      padding:12px;
      height: 295px;
      overflow-y:auto;
      background:#f4f6f8;
    }

    .msg{
      background:#fff;
      padding:10px 12px;
      margin-bottom:10px;
      border-radius:12px;
      line-height:1.35;
      font-size:14px;
      box-shadow:0 1px 0 rgba(0,0,0,.04);
      white-space:pre-wrap;
    }
    .user{
      background:#dff3ff;
      text-align:right;
    }
    .bot{
      text-align:left;
    }

    /* Secci√≥n de opciones */
    #chat-options{
      padding:12px;
      background:#fff;
      border-top:1px solid #e6e6e6;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .box-title{
      background:#fff3e0;
      border:1px solid #ffd7b0;
      padding:10px 12px;
      border-radius:12px;
      font-weight:bold;
    }

    .radio-list{
      border:1px solid #e5e7eb;
      border-radius:12px;
      overflow:hidden;
      background:#fff;
    }
    .radio-item{
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px 12px;
      border-bottom:1px solid #eef2f6;
    }
    .radio-item:last-child{ border-bottom:none; }
    .radio-item label{
      width:100%;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:14px;
    }
    .radio-item .left{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .input-row{
      display:flex;
      gap:8px;
      align-items:center;
    }
    #user-input{
      flex:1;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid #d1d5db;
      outline:none;
      font-size:14px;
    }
    #send-btn, #continue-btn{
      padding:10px 14px;
      border:none;
      border-radius:12px;
      cursor:pointer;
      font-weight:bold;
      font-size:14px;
    }
    #send-btn{
      background:#1f6feb;
      color:#fff;
    }
    #continue-btn{
      background:#111827;
      color:#fff;
    }
    #send-btn:hover{ filter:brightness(.95); }
    #continue-btn:hover{ filter:brightness(.95); }

    .hint{
      font-size:12px;
      color:#6b7280;
      margin-top:-4px;
    }
  </style>
</head>

<body>

<button id="chat-btn" aria-label="Abrir chat">üí¨</button>

<div id="chat-box" role="dialog" aria-label="EmaBot">
  <div id="chat-header">
    <div class="left">
      <span aria-hidden="true">ü§ñ</span>
      <div class="title">EmaBot ‚Äî Colegio Integral Emanuel</div>
    </div>
    <div class="actions">
      <button id="voice-btn" title="Activar/desactivar voz" aria-label="Voz">üîä</button>
      <button id="close-btn" title="Cerrar" aria-label="Cerrar">‚úñ</button>
    </div>
  </div>

  <div id="chat-messages"></div>

  <div id="chat-options">
    <div class="box-title">Seleccione una opci√≥n:</div>

    <div class="radio-list" id="menu">
      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-direccion" value="direccion" checked>
        <label for="opt-direccion">
          <div class="left"><span>üìç</span><span>Direcci√≥n</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-matricula" value="matricula">
        <label for="opt-matricula">
          <div class="left"><span>üíµ</span><span>Matr√≠cula</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-mensualidad" value="mensualidad">
        <label for="opt-mensualidad">
          <div class="left"><span>üìÖ</span><span>Mensualidad</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-ofrece" value="ofrece">
        <label for="opt-ofrece">
          <div class="left"><span>üéì</span><span>¬øQu√© ofrece?</span></div>
        </label>
      </div>

      <div class="radio-item">
        <input type="radio" name="menuOpt" id="opt-contacto" value="contacto">
        <label for="opt-contacto">
          <div class="left"><span>üì≤</span><span>Contacto (WhatsApp)</span></div>
        </label>
      </div>
    </div>

    <button id="continue-btn">CONTINUAR</button>

    <div class="hint">Tambi√©n puede escribir su pregunta:</div>
    <div class="input-row">
      <input id="user-input" placeholder="Escriba su pregunta..." />
      <button id="send-btn">Enviar</button>
    </div>
  </div>
</div>

<script>
  // =========================
  // CONFIG
  // =========================
  const WHATSAPP_NUMBER = "50588543012"; // ‚úÖ directo al n√∫mero
  const HORARIO = "Lunes a Viernes, 7:00 a.m. a 3:00 p.m.";
  const SITE_NAME = "Colegio Integral Emanuel";
  const BOT_NAME = "EmaBot";

  // =========================
  // ELEMENTOS
  // =========================
  const chatBtn = document.getElementById("chat-btn");
  const chatBox = document.getElementById("chat-box");
  const closeBtn = document.getElementById("close-btn");
  const messages = document.getElementById("chat-messages");

  const continueBtn = document.getElementById("continue-btn");
  const sendBtn = document.getElementById("send-btn");
  const userInput = document.getElementById("user-input");

  const voiceBtn = document.getElementById("voice-btn");

  // =========================
  // VOZ (Web Speech API)
  // Importante: en muchos tel√©fonos SOLO habla si el usuario toc√≥ algo antes (ya lo hace al abrir).
  // =========================
  let voiceEnabled = false;

  function canSpeak() {
    return "speechSynthesis" in window && typeof SpeechSynthesisUtterance !== "undefined";
  }

  function speak(text) {
    if (!voiceEnabled) return;
    if (!canSpeak()) return;

    // Cancela lo anterior
    window.speechSynthesis.cancel();

    const u = new SpeechSynthesisUtterance(text);
    u.lang = "es-ES";
    u.rate = 1.0;
    u.pitch = 1.0;
    window.speechSynthesis.speak(u);
  }

  voiceBtn.addEventListener("click", () => {
    voiceEnabled = !voiceEnabled;
    voiceBtn.textContent = voiceEnabled ? "üîà" : "üîä";
    addBotMessage(voiceEnabled
      ? "‚úÖ Voz activada. A partir de ahora leer√© mis respuestas."
      : "üîá Voz desactivada."
    );
  });

  // =========================
  // UTILIDADES CHAT
  // =========================
  function addBotMessage(text) {
    const div = document.createElement("div");
    div.className = "msg bot";
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
    speak(text);
  }

  function addUserMessage(text) {
    const div = document.createElement("div");
    div.className = "msg user";
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function normalizeText(text) {
    return text
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .trim();
  }

  // =========================
  // RESPUESTAS (FAQ)
  // =========================
  function getResponse(type) {
    switch(type) {
      case "direccion":
        return "üìç Direcci√≥n:\nCostado Este del MaxiPal√≠, 25 varas al norte.";
      case "matricula":
        return "üíµ Matr√≠cula:\nLa informaci√≥n de matr√≠cula se brinda por WhatsApp para atenci√≥n personalizada.";
      case "mensualidad":
        return "üìÖ Mensualidad:\nLa mensualidad es de C$ 1,450.";
      case "ofrece":
        return "üéì ¬øQu√© ofrece el colegio?\nEducaci√≥n integral, formaci√≥n en valores, docentes capacitados y un ambiente seguro para nuestros estudiantes.";
      case "contacto":
        return "üì≤ Contacto:\nAl presionar, se abrir√° WhatsApp para comunicarse directamente con el colegio.";
      default:
        return null;
    }
  }

  function suggestNext() {
    return "üòä ¬øEn qu√© m√°s podemos ayudarle?\nPuede seleccionar otra opci√≥n o escribir su consulta.";
  }

  function closeBlessing() {
    return "‚ú® Bendiciones. Quedamos a su disposici√≥n.";
  }

  function openWhatsAppDirect() {
    // ‚úÖ directo al n√∫mero (sin texto)
    window.open("https://wa.me/" + WHATSAPP_NUMBER, "_blank");
  }

  // =========================
  // FLUJO PRINCIPAL
  // =========================
  function greetOnce() {
    if (messages.dataset.greeted === "yes") return;
    messages.dataset.greeted = "yes";

    addBotMessage("üëã Bienvenido(a) al " + SITE_NAME + ".");
    addBotMessage("Soy " + BOT_NAME + ", su asistente virtual institucional.");
    addBotMessage("üïí Horario de atenci√≥n: " + HORARIO + ".");
    addBotMessage("üòä ¬øEn qu√© m√°s podemos ayudarle?");
  }

  function toggleChat(open) {
    const isOpen = chatBox.style.display === "block";
    const nextState = (open === undefined) ? !isOpen : open;
    chatBox.style.display = nextState ? "block" : "none";

    if (nextState) {
      greetOnce();
      // Truco para m√≥viles: tras abrir (click del usuario), la voz ya puede funcionar si est√° activada
    } else {
      // Cierre formal
      addBotMessage(closeBlessing());
    }
  }

  chatBtn.addEventListener("click", () => toggleChat());
  closeBtn.addEventListener("click", () => toggleChat(false));

  // =========================
  // BOT√ìN CONTINUAR (RADIO)
  // =========================
  continueBtn.addEventListener("click", () => {
    const selected = document.querySelector('input[name="menuOpt"]:checked');
    if (!selected) return;

    const type = selected.value;
    const labelMap = {
      direccion: "Direcci√≥n",
      matricula: "Matr√≠cula",
      mensualidad: "Mensualidad",
      ofrece: "¬øQu√© ofrece?",
      contacto: "Contacto"
    };

    addUserMessage(labelMap[type] || type);

    const resp = getResponse(type);

    if (type === "contacto") {
      addBotMessage(resp);
      openWhatsAppDirect();
      addBotMessage(closeBlessing());
      return;
    }

    addBotMessage(resp);
    addBotMessage(suggestNext());
  });

  // =========================
  // PREGUNTA ESCRITA
  // =========================
  function handleUserQuestion() {
    const question = (userInput.value || "").trim();
    if (!question) return;

    addUserMessage(question);
    userInput.value = "";

    const q = normalizeText(question);

    // Reglas simples por palabras clave
    if (q.includes("direccion") || q.includes("ubicacion") || q.includes("donde")) {
      addBotMessage(getResponse("direccion"));
      addBotMessage(suggestNext());
      return;
    }

    if (q.includes("mensualidad") || q.includes("cuota") || q.includes("pago mensual")) {
      addBotMessage(getResponse("mensualidad"));
      addBotMessage(suggestNext());
      return;
    }

    if (q.includes("matricula") || q.includes("inscripcion") || q.includes("inscripci√≥n")) {
      addBotMessage(getResponse("matricula"));
      addBotMessage(suggestNext());
      return;
    }

    if (q.includes("ofrece") || q.includes("servicios") || q.includes("que ofrece") || q.includes("qu√© ofrece")) {
      addBotMessage(getResponse("ofrece"));
      addBotMessage(suggestNext());
      return;
    }

    if (q.includes("whatsapp") || q.includes("contacto") || q.includes("telefono") || q.includes("tel")) {
      addBotMessage(getResponse("contacto"));
      openWhatsAppDirect();
      addBotMessage(closeBlessing());
      return;
    }

    // Si no sabe -> WhatsApp directo al n√∫mero
    addBotMessage("Por el momento no tengo registrada esa informaci√≥n. Para una respuesta r√°pida, comun√≠quese por WhatsApp.");
    openWhatsAppDirect();
    addBotMessage(closeBlessing());
  }

  sendBtn.addEventListener("click", handleUserQuestion);
  userInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") handleUserQuestion();
  });

  // =========================
  // NOTA IMPORTANTE (tu caso)
  // Si en GitHub Pages sale en blanco: normalmente es por un error de JavaScript.
  // Este c√≥digo ya est√° ‚Äúcerrado‚Äù correctamente (sin </script> extra).
  // =========================
</script>

</body>
</html>
