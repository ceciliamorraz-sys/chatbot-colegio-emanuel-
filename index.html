<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>EmaBot - Colegio Integral Emanuel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body { font-family: Arial, sans-serif; }

    #chat-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #1f6feb;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 26px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 99999;
    }

    #chat-box {
      display: none;
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 340px;
      height: 520px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      overflow: hidden;
      z-index: 99999;
    }

    #chat-header {
      background: #1f6feb;
      color: #fff;
      padding: 12px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #chat-messages {
      padding: 10px;
      height: 280px;
      overflow-y: auto;
      background: #f4f6f8;
      font-size: 14px;
      white-space: pre-line;
    }

    .msg {
      background: #fff;
      padding: 8px 10px;
      margin-bottom: 8px;
      border-radius: 10px;
    }

    .user {
      background: #dff3ff;
      text-align: right;
    }

    .btn {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
      font-size: 14px;
    }

    .btn:hover { background: #f0f0f0; }

    #chat-actions, #chat-options {
      padding: 10px;
      display: grid;
      gap: 8px;
      background: #fff;
    }

    .primary {
      background: #1f6feb;
      color: #fff;
      border-color: #1f6feb;
    }
  </style>
</head>

<body>

<button id="chat-btn">ğŸ’¬</button>

<div id="chat-box">
  <div id="chat-header">
    ğŸ¤– EmaBot â€“ Colegio Integral Emanuel
    <span style="cursor:pointer;" onclick="toggleChat()">âœ–</span>
  </div>

  <div id="chat-messages"></div>

  <div id="chat-actions">
    <button class="btn primary" onclick="speakLast()">ğŸ”Š Hablar</button>
    <button class="btn" onclick="startListening()">ğŸ¤ Escuchar</button>
  </div>

  <div id="chat-options">
    <button class="btn" onclick="sendFAQ('direccion')">ğŸ“ DirecciÃ³n</button>
    <button class="btn" onclick="sendFAQ('matricula')">ğŸ’µ MatrÃ­cula</button>
    <button class="btn" onclick="sendFAQ('mensualidad')">ğŸ“… Mensualidad</button>
    <button class="btn" onclick="sendFAQ('ofrece')">ğŸ“ Â¿QuÃ© ofrece?</button>
    <button class="btn" onclick="sendFAQ('horario')">â° Horario</button>
    <button class="btn" onclick="sendFAQ('whatsapp')">ğŸ“² WhatsApp</button>
  </div>
</div>

<script>
const SCHOOL = {
  name: "Colegio Integral Emanuel",
  address: "Costado Este del Maxipali, 25 varas al norte.",
  monthly: "C$ 1,450",
  horario: "Lunes a Viernes de 7:00 a.m. a 3:00 p.m.",
  whatsapp: "50588543012"
};

const chatBtn = document.getElementById("chat-btn");
const chatBox = document.getElementById("chat-box");
const messages = document.getElementById("chat-messages");

let greeted = false;
let lastBotText = "";

chatBtn.onclick = toggleChat;

function toggleChat() {
  chatBox.style.display = chatBox.style.display === "block" ? "none" : "block";
  if (!greeted) {
    greeted = true;
    addBotMessage(
      "ğŸ‘‹ Â¡Hola! Soy EmaBot, el asistente virtual del " + SCHOOL.name +
      ".\nâ° Horario: " + SCHOOL.horario +
      "\n\nSelecciona una opciÃ³n o presiona ğŸ¤ para hablar."
    , true);
  }
}

function addBotMessage(text, speakIt=false) {
  const finalText = text + "\n\nğŸ˜Š Â¿En quÃ© mÃ¡s podemos ayudarte?";
  const div = document.createElement("div");
  div.className = "msg";
  div.innerText = finalText;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
  lastBotText = finalText;
  if (speakIt) speak(finalText);
}

function addUserMessage(text) {
  const div = document.createElement("div");
  div.className = "msg user";
  div.innerText = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function speak(text) {
  if (!("speechSynthesis" in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "es-ES";
  window.speechSynthesis.speak(u);
}

function speakLast() {
  if (lastBotText) speak(lastBotText);
}

function openWhatsApp(text) {
  window.open(
    "https://wa.me/" + SCHOOL.whatsapp + "?text=" + encodeURIComponent(text),
    "_blank"
  );
}

function sendFAQ(type) {
  let r = "";
  if (type === "direccion") r = "ğŸ“ " + SCHOOL.address;
  if (type === "mensualidad") r = "ğŸ“… La mensualidad es de " + SCHOOL.monthly;
  if (type === "ofrece") r = "ğŸ“ Ofrecemos educaciÃ³n integral y formaciÃ³n en valores.";
  if (type === "horario") r = "â° Atendemos " + SCHOOL.horario;
  if (type === "matricula") {
    r = "ğŸ’µ La informaciÃ³n de matrÃ­cula se brinda por WhatsApp.";
    openWhatsApp("Hola, deseo informaciÃ³n de matrÃ­cula del Colegio Integral Emanuel.");
  }
  if (type === "whatsapp") {
    r = "ğŸ“² Te estamos redirigiendo a WhatsApp.";
    openWhatsApp("Hola, deseo informaciÃ³n del Colegio Integral Emanuel.");
  }
  addUserMessage(type);
  setTimeout(() => addBotMessage(r, true), 300);
}

function startListening() {
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR) {
    addBotMessage("âš ï¸ Tu navegador no soporta reconocimiento de voz.");
    return;
  }
  const rec = new SR();
  rec.lang = "es-ES";
  rec.onresult = e => {
    const text = e.results[0][0].transcript;
    addUserMessage("ğŸ¤ " + text);
    addBotMessage("ğŸ“² Te atenderemos por WhatsApp.", true);
    openWhatsApp("Consulta: " + text);
  };
  rec.start();
}
</script>

</body>
</html>

