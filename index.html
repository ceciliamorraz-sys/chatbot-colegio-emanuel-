<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EmaBot - Colegio Integral Emanuel</title>
  <style>
    body { font-family: Arial, sans-serif; }

    /* Bot√≥n flotante */
    #chat-btn{
      position: fixed; bottom: 20px; right: 20px;
      background:#1f6feb; color:#fff; border:none;
      border-radius:50%; width:60px; height:60px;
      font-size:26px; cursor:pointer;
      box-shadow:0 4px 10px rgba(0,0,0,0.3);
      z-index:99999;
      display:flex; align-items:center; justify-content:center;
    }

    /* Caja chat */
    #chat-box{
      display:none;
      position: fixed; bottom: 90px; right: 20px;
      width: 360px; max-width: calc(100vw - 40px);
      height: 520px; max-height: calc(100vh - 140px);
      background:#fff; border-radius:14px;
      box-shadow:0 8px 18px rgba(0,0,0,0.25);
      overflow:hidden;
      z-index:99999;
    }

    #chat-header{
      background:#1f6feb; color:#fff;
      padding:12px 14px;
      font-weight:bold;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    #chat-header .title{
      display:flex; align-items:center; gap:8px;
      font-weight:700;
      min-width:0;
    }
    #chat-header .title span.txt{
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width: 210px;
    }
    #chat-header .actions{
      display:flex; align-items:center; gap:10px;
    }
    #chat-header button{
      background:transparent; border:none; color:#fff;
      font-size:18px; cursor:pointer;
    }

    #chat-messages{
      padding:12px;
      height: 365px;
      overflow-y:auto;
      background:#f4f6f8;
    }

    .msg{
      background:#fff;
      padding:10px 12px;
      border-radius:12px;
      margin-bottom:10px;
      box-shadow:0 1px 0 rgba(0,0,0,0.06);
      line-height:1.35;
      font-size:14px;
      white-space:pre-wrap;
    }
    .msg.user{
      background:#e8f2ff;
    }

    #chat-footer{
      border-top:1px solid #eee;
      padding:10px;
      background:#fff;
    }

    .row{
      display:flex; gap:8px;
    }
    #user-input{
      flex:1;
      padding:10px 12px;
      border:1px solid #ddd;
      border-radius:10px;
      outline:none;
      font-size:14px;
    }
    #send-btn{
      padding:10px 14px;
      border:none;
      border-radius:10px;
      background:#1f6feb;
      color:#fff;
      font-weight:600;
      cursor:pointer;
    }

    .chips{
      display:flex; flex-wrap:wrap; gap:8px;
      margin-top:10px;
    }
    .chip{
      border:1px solid #d7e7ff;
      background:#f1f7ff;
      padding:8px 10px;
      border-radius:999px;
      cursor:pointer;
      font-size:13px;
      user-select:none;
    }

    .panel{
      margin-top:10px;
      background:#fff;
      border:1px solid #eee;
      border-radius:12px;
      padding:12px;
    }
    .panel h4{
      margin:0 0 10px 0;
      font-size:14px;
    }
    .field{
      display:flex; flex-direction:column;
      gap:6px;
      margin-bottom:10px;
    }
    .field label{
      font-size:12px; color:#333;
    }
    .field input, .field textarea{
      font-size:14px;
      padding:10px 10px;
      border:1px solid #ddd;
      border-radius:10px;
      outline:none;
    }
    .field textarea{ resize:none; min-height:80px; }

    .btn{
      width:100%;
      padding:10px 12px;
      border:none;
      border-radius:10px;
      background:#1f6feb;
      color:#fff;
      font-weight:700;
      cursor:pointer;
    }
    .btn.secondary{
      background:#eef5ff;
      color:#1f6feb;
      border:1px solid #cfe3ff;
    }

    /* Responsive m√≥vil */
    @media (max-width: 480px){
      #chat-box{
        right:10px; left:10px;
        width:auto;
        bottom: 90px;
        height: 72vh;
      }
      #chat-messages{ height: calc(72vh - 140px); }
      #chat-header .title span.txt{ max-width: 160px; }
    }
  </style>
</head>

<body>

<button id="chat-btn" aria-label="Abrir chat">üí¨</button>

<div id="chat-box">
  <div id="chat-header">
    <div class="title">
      ü§ñ <span class="txt">EmaBot ‚Äì Colegio Integral Emanuel</span>
    </div>
    <div class="actions">
      <button id="voice-btn" title="Activar voz">üîä</button>
      <button id="close-btn" title="Cerrar">‚úï</button>
    </div>
  </div>

  <div id="chat-messages"></div>

  <div id="chat-footer">
    <div class="row">
      <input id="user-input" type="text" placeholder="Escribe tu pregunta aqu√≠..." />
      <button id="send-btn">Enviar</button>
    </div>

    <div class="chips">
      <div class="chip" data-intent="direccion">üìç Direcci√≥n</div>
      <div class="chip" data-intent="matricula">üü© Matr√≠cula</div>
      <div class="chip" data-intent="mensualidad">üßæ Mensualidad</div>
      <div class="chip" data-intent="horario">‚è∞ Horario</div>
      <div class="chip" data-intent="oferta">üéì ¬øQu√© ofrece?</div>
      <div class="chip" data-intent="contacto_form">üìù Formulario de contacto</div>
      <div class="chip" data-intent="whatsapp">üì≤ WhatsApp</div>
    </div>
  </div>
</div>

<script>
  // ‚úÖ TU N√öMERO (Nicaragua 505 + 8 d√≠gitos)
  const WHATSAPP_NUMBER = "50558753725";

  // Voz (Text-to-Speech)
  let voiceEnabled = false;

  const chatBtn = document.getElementById("chat-btn");
  const chatBox = document.getElementById("chat-box");
  const closeBtn = document.getElementById("close-btn");
  const voiceBtn = document.getElementById("voice-btn");

  const chatMessages = document.getElementById("chat-messages");
  const userInput = document.getElementById("user-input");
  const sendBtn = document.getElementById("send-btn");

  function addMsg(text, who="bot"){
    const div = document.createElement("div");
    div.className = "msg " + (who === "user" ? "user" : "bot");
    div.textContent = text;
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    // hablar solo mensajes del bot
    if(who === "bot" && voiceEnabled){
      speak(text);
    }
  }

  function speak(text){
    try{
      if(!("speechSynthesis" in window)) return;
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "es-ES";
      u.rate = 1;
      u.pitch = 1;
      window.speechSynthesis.speak(u);
    }catch(e){}
  }

  function openWhatsApp(message){
    const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
    window.open(url, "_blank");
  }

  function showContactForm(){
    const panel = document.createElement("div");
    panel.className = "panel";
    panel.innerHTML = `
      <h4>üìù Formulario de contacto</h4>

      <div class="field">
        <label>Nombre *</label>
        <input id="c-name" type="text" placeholder="Ej: Mar√≠a L√≥pez" />
      </div>

      <div class="field">
        <label>Tel√©fono (opcional)</label>
        <input id="c-phone" type="tel" placeholder="Ej: 8888-9999" />
      </div>

      <div class="field">
        <label>Correo (opcional)</label>
        <input id="c-email" type="email" placeholder="Ej: correo@gmail.com" />
      </div>

      <div class="field">
        <label>Mensaje *</label>
        <textarea id="c-msg" placeholder="Escriba su consulta..."></textarea>
      </div>

      <button class="btn" id="c-send">Enviar por WhatsApp</button>
      <button class="btn secondary" id="c-cancel" style="margin-top:8px;">Cancelar</button>
    `;
    chatMessages.appendChild(panel);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    panel.querySelector("#c-send").addEventListener("click", () => {
      const name = panel.querySelector("#c-name").value.trim();
      const phone = panel.querySelector("#c-phone").value.trim();
      const email = panel.querySelector("#c-email").value.trim();
      const msg = panel.querySelector("#c-msg").value.trim();

      if(!name || !msg){
        addMsg("Por favor completa al menos: Nombre y Mensaje. üôè", "bot");
        return;
      }

      const final =
`üìå *Formulario de contacto - Colegio Integral Emanuel*
üë§ Nombre: ${name}
üìû Tel√©fono: ${phone || "No indic√≥"}
‚úâÔ∏è Correo: ${email || "No indic√≥"}
üìù Mensaje: ${msg}`;

      openWhatsApp(final);
      addMsg("Listo ‚úÖ Se abrir√° WhatsApp para enviar su mensaje. Bendiciones. Quedamos a su disposici√≥n.", "bot");
    });

    panel.querySelector("#c-cancel").addEventListener("click", () => {
      panel.remove();
      addMsg("Formulario cerrado. ¬øEn qu√© m√°s podemos ayudarle?", "bot");
    });
  }

  function handleIntent(intent){
    switch(intent){
      case "direccion":
        addMsg("üìç Direcci√≥n: Costado Este del MaxiPali, 25 varas al norte.", "bot");
        addMsg("Bendiciones. Quedamos a su disposici√≥n.", "bot");
        break;

      case "matricula":
        addMsg("üü© Matr√≠cula: Para informaci√≥n actualizada, escr√≠banos por WhatsApp y con gusto le atendemos.", "bot");
        openWhatsApp("Hola, deseo informaci√≥n sobre matr√≠cula del Colegio Integral Emanuel.");
        break;

      case "mensualidad":
        addMsg("üßæ Mensualidad: Escr√≠banos por WhatsApp para brindarle el monto seg√∫n el nivel y a√±o.", "bot");
        openWhatsApp("Hola, deseo informaci√≥n sobre mensualidad del Colegio Integral Emanuel.");
        break;

      case "horario":
        addMsg("‚è∞ Horario de atenci√≥n: Lunes a Viernes, 7:00 a.m. a 3:00 p.m.", "bot");
        addMsg("¬øEn qu√© m√°s podemos ayudarle?", "bot");
        break;

      case "oferta":
        addMsg("üéì Ofrecemos educaci√≥n integral, formaci√≥n en valores, docentes capacitados y acompa√±amiento a las familias.", "bot");
        addMsg("¬øDesea informaci√≥n de inscripci√≥n, costos o requisitos? Puede escribir su pregunta.", "bot");
        break;

      case "contacto_form":
        addMsg("Perfecto ‚úÖ Complete el formulario y se enviar√° directo por WhatsApp.", "bot");
        showContactForm();
        break;

      case "whatsapp":
        addMsg("üì≤ Le abrir√© WhatsApp para contactarnos.", "bot");
        openWhatsApp("Hola, necesito informaci√≥n del Colegio Integral Emanuel.");
        break;

      default:
        addMsg("No estoy seguro de esa opci√≥n. ¬øDesea contactarnos por WhatsApp?", "bot");
        openWhatsApp("Hola, tengo una consulta para el Colegio Integral Emanuel.");
    }
  }

  // Mensaje de bienvenida
  function initWelcome(){
    addMsg("üëã Bienvenido(a) al Colegio Integral Emanuel.", "bot");
    addMsg("Soy EmaBot, su asistente virtual institucional.", "bot");
    addMsg("‚è∞ Horario de atenci√≥n: Lunes a Viernes, 7:00 a.m. a 3:00 p.m.", "bot");
    addMsg("üòä ¬øEn qu√© m√°s podemos ayudarle?", "bot");
  }

  // Eventos UI
  chatBtn.addEventListener("click", () => {
    chatBox.style.display = "block";
    chatBtn.style.display = "none";
    if(chatMessages.childElementCount === 0){
      initWelcome();
    }
  });

  closeBtn.addEventListener("click", () => {
    chatBox.style.display = "none";
    chatBtn.style.display = "flex";
  });

  voiceBtn.addEventListener("click", () => {
    voiceEnabled = !voiceEnabled;
    voiceBtn.textContent = voiceEnabled ? "üîá" : "üîä";
    addMsg(voiceEnabled
      ? "Voz activada ‚úÖ (Nota: en tel√©fono, el navegador solo permite voz despu√©s de tocar este bot√≥n)."
      : "Voz desactivada ‚úÖ", "bot");
  });

  // Chips
  document.querySelectorAll(".chip").forEach(chip=>{
    chip.addEventListener("click", ()=>{
      const intent = chip.getAttribute("data-intent");
      handleIntent(intent);
    });
  });

  // Enviar texto escrito
  function handleText(){
    const q = userInput.value.trim();
    if(!q) return;
    addMsg(q, "user");
    userInput.value = "";

    // Respuestas simples (FAQ b√°sico)
    const t = q.toLowerCase();

    if(t.includes("direccion") || t.includes("ubic") || t.includes("queda")){
      handleIntent("direccion");
      return;
    }
    if(t.includes("horario") || t.includes("atienden") || t.includes("abren")){
      handleIntent("horario");
      return;
    }
    if(t.includes("matric") || t.includes("inscrip")){
      handleIntent("matricula");
      return;
    }
    if(t.includes("mensual") || t.includes("pago") || t.includes("cuota")){
      handleIntent("mensualidad");
      return;
    }
    if(t.includes("ofrece") || t.includes("servicio") || t.includes("niveles")){
      handleIntent("oferta");
      return;
    }
    if(t.includes("contacto") || t.includes("formulario")){
      handleIntent("contacto_form");
      return;
    }

    // Si no entiende -> WhatsApp
    addMsg("No tengo esa informaci√≥n en este momento. üôè Le enviar√© directo a WhatsApp para atenci√≥n personalizada.", "bot");
    openWhatsApp(`Hola, tengo esta consulta: "${q}"`);
  }

  sendBtn.addEventListener("click", handleText);
  userInput.addEventListener("keydown", (e)=>{
    if(e.key === "Enter") handleText();
  });

</script>
</body>
</html>
